<!DOCTYPE html>
<html prefix="og: https://ogp.me/ns#" class="mdui-theme-auto" data-theme="auto">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="author" content="Eagle233">
  <meta name="generator" content="Hexo 7.3.0">
    <meta name="description" content="整体思路：利用汇编语言知识结合 gdb 调试一起推导过程，仅调试和仅观察都无法解开问题，必须一边调试一边理解汇编代码，找出答案规律。  Phase 1汇编代码0000000000400ee0 &lt;phase_1&gt;:   400ee0:   48 83 ec 08             sub    $0x8,%rsp    400ee4:   be 00 24 40 00">
<meta property="og:type" content="article">
<meta property="og:title" content="[CSAPP] Lab2 - Bomb Lab Report">
<meta property="og:url" content="https://blog.eagle233.top/2025/04/14/CSAPP/CSAPP-Lab2-Bomb-Lab-Report/index.html">
<meta property="og:site_name" content="Eagle233-Blog">
<meta property="og:description" content="整体思路：利用汇编语言知识结合 gdb 调试一起推导过程，仅调试和仅观察都无法解开问题，必须一边调试一边理解汇编代码，找出答案规律。  Phase 1汇编代码0000000000400ee0 &lt;phase_1&gt;:   400ee0:   48 83 ec 08             sub    $0x8,%rsp    400ee4:   be 00 24 40 00">
<meta property="og:locale">
<meta property="og:image" content="https://s2.loli.net/2025/04/13/ilBF8UfAdHs7JTg.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/13/4rfZhIgwNKpRmTv.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/13/eAidJQslZ71PSgF.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/13/BskvmIge45TuS1f.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/14/AwjyF7LZvIgHQ43.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/14/QsUo7mROE1VBiKY.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/14/KS3LzR2BT9nGMhv.png">
<meta property="og:image" content="https://s2.loli.net/2025/04/14/sB6ODkRyfUSt5HN.png">
<meta property="article:published_time" content="2025-04-14T13:38:55.000Z">
<meta property="article:modified_time" content="2025-04-14T13:54:01.472Z">
<meta property="article:author" content="Eagle233">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2025/04/13/ilBF8UfAdHs7JTg.png">
      <link rel="icon" href="">
      <title>
        
          [CSAPP] Lab2 - Bomb Lab Report - Eagle233-Blog
              
      </title>
      
<link rel="stylesheet" href="/css/site.css">

      
<link rel="stylesheet" href="/css/mdui_2.0.3/mdui.css">

      <style>
        /*禁用mdui对code的样式，因为它干扰了prism.js*/
        .mdui-prose pre code {
          background-color: transparent;
          padding: 0px 0px;
        }
      </style>
      
<script src="/css/mdui_2.0.3/mdui.global.js"></script>

      
<script src="/fancybox/fancybox.umd.js"></script>

      
<link rel="stylesheet" href="/fancybox/fancybox.css">

      
<script src="/carousel/carousel.umd.js"></script>

      
<link rel="stylesheet" href="/carousel/carousel.css">

      
<link rel="stylesheet" href="/css/prism.css">

          
<link rel="stylesheet" href="/css/katex.min.css">

            
<link rel="stylesheet" href="/css/font-material-icon-filled/MaterialIconFilled.css">

              <!-- Filled -->
              <script>window.$=mdui.$</script>
</head>

  <body class="line-numbers">
    <mdui-layout>
      <mdui-top-app-bar>
        <mdui-button-icon icon="menu" id="menu-btn">
        </mdui-button-icon>
        <mdui-top-app-bar-title>
          Eagle233-Blog
        </mdui-top-app-bar-title>
        <div style="flex-grow: 1"></div>
        <mdui-button-icon icon="search" id="search-dlg-btn"></mdui-button-icon>
          
      </mdui-top-app-bar>
      <mdui-navigation-drawer close-on-overlay-click close-on-esc id="drawer">
    <mdui-list>
        
            
            <mdui-list-item rounded icon="home"
                href="/"
                
                
                rel="next">
                Home
            </mdui-list-item>
            
            
            
            <mdui-list-item rounded icon="folder"
                href="/categories"
                
                
                rel="next">
                Categories
            </mdui-list-item>
            
            
            
            <mdui-list-item rounded icon="bookmark"
                href="/tags"
                
                
                rel="next">
                Tags
            </mdui-list-item>
            
            
            
            <mdui-list-item rounded icon="archive"
                href="/archives"
                
                
                rel="next">
                Archives
            </mdui-list-item>
            
            
            
            <mdui-list-item rounded icon="info"
                href="/about"
                
                
                rel="next">
                About
            </mdui-list-item>
            
            
    </mdui-list>
</mdui-navigation-drawer>
        <mdui-layout-main style="min-height: 800px;" id="main">
          <div style="padding-left: 16px;padding-right: 16px;" id="content">
            <mdui-card variant="filled" style="padding: 16px;width: 100%;">
  <div class="mdui-prose post" id="post-all">
    <h1 style="margin-bottom: 8px;">
      [CSAPP] Lab2 - Bomb Lab Report
    </h1>
    <span class="post-date">
      <mdui-icon name="date_range" style="vertical-align: text-bottom;font-size: 18px;"></mdui-icon>
      2025-04-14 21:38:55 &nbsp; <mdui-icon name="update"
          style="vertical-align: text-bottom;font-size: 18px;"></mdui-icon>
        2025-04-14 21:54:01
    </span>
    <br>
    <span>
        Categories
          
            <!-- <mdui-chip href="/categories/CSAPP/" variant="filter" style="vertical-align: middle;">
                          CSAPP
                      </mdui-chip> -->
            <a href="/categories/CSAPP/">
              CSAPP
            </a>
            
              <br>
      </span>
      
        
          Tags
            
                
                  <!-- photos gallery -->
                  
                      <!-- content -->
                      <ul>
<li><strong>整体思路：利用汇编语言知识结合 gdb 调试一起推导过程，仅调试和仅观察都无法解开问题，必须一边调试一边理解汇编代码，找出答案规律。</strong></li>
</ul>
<h2 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase 1"></a>Phase 1</h2><h3 id="汇编代码"><a href="#汇编代码" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">0000000000400ee0 <span class="token operator">&lt;</span>phase_1<span class="token operator">></span>:
  400ee0:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">08</span>             sub    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span> 
  400ee4:   be <span class="token number">00</span> <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x402400</span>,<span class="token operator">%</span><span class="token register variable">esi</span> 
  COMMENT <span class="token comment">; 将 0x402400 中的内容作为第二个参数传入 strings_not_equal 函数</span>
  400ee9:   e8 4a <span class="token number">04</span> <span class="token number">00</span> <span class="token number">00</span>          call   <span class="token number">401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
  400eee:   <span class="token number">85</span> c0                   test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400ef0:   <span class="token number">74</span> <span class="token number">05</span>                   je     400ef7 <span class="token operator">&lt;</span>phase_1<span class="token operator">+</span><span class="token number">0x17</span><span class="token operator">></span>
  COMMENT <span class="token comment">; 如果两个参数相等，跳过炸弹</span>
  400ef2:   e8 <span class="token number">43</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400ef7:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">08</span>             add    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400efb:   c3                      ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h3><p><code>400ee0</code>中，<code>0x402400</code>内存中的内容存到<code>%esi</code>寄存器中，作为第二个参数传入<code>strings_not_equal</code>函数中（第一个是<code>%edi</code>，是用户传入的）。</p>
<p>之后在<code>400ee9</code>调用了函数比较两个字符串的内容，倘若相等，返回<code>0</code>。</p>
<p>接下来<code>400eee</code>和<code>400ef0</code>判断返回值是多少，如果是<code>0</code>，即字符串相等，则跳过炸弹到<code>400ef7</code>，反之到<code>400ef2</code>触发炸弹。</p>
<p>于是，我们现在明白了，只需要知道<code>0x402400</code>里面存放的是什么，然后在gdb中输入这个字符串，就可以解开炸弹了。</p>
<p>最终答案为：</p>
<p><strong><code>Border relations with Canada have never been better.</code></strong></p>
<h3 id="伪代码"><a href="#伪代码" class="headerlink" title="伪代码"></a>伪代码</h3><p>我们可以得到如下C伪代码便于理解：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">strings_not_equal</span><span class="token punctuation">(</span>string <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> string <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> 
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> <span class="token function">phase_1</span><span class="token punctuation">(</span>userInput<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x402400</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_not_equal</span><span class="token punctuation">(</span>userInput<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x402400</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        The bomb is defused<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        The bomb explodes<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/13/ilBF8UfAdHs7JTg.png" alt="phase_1.png"></p>
<hr>
<h2 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase 2"></a>Phase 2</h2><h3 id="汇编代码-1"><a href="#汇编代码-1" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">0000000000400efc <span class="token operator">&lt;</span>phase_2<span class="token operator">></span>:
  400efc:   <span class="token number">55</span>                      push   <span class="token operator">%</span><span class="token register variable">rbp</span>
  400efd:   <span class="token number">53</span>                      push   <span class="token operator">%</span><span class="token register variable">rbx</span>
  400efe:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">28</span>             sub    <span class="token operator">$</span><span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400f02:   <span class="token number">48</span> <span class="token number">89</span> e6                mov    <span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>
  COMMENT <span class="token comment">; 栈底现在往下 0x28 个单位</span>
  400f05:   e8 <span class="token number">52</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span>          call   40145c <span class="token operator">&lt;</span>read_six_numbers<span class="token operator">></span>
  COMMENT <span class="token comment">; 输入6个数字</span>
  400f0a:   <span class="token number">83</span> 3c <span class="token number">24</span> <span class="token number">01</span>             cmpl   <span class="token operator">$</span><span class="token number">0x1</span>,(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  COMMENT <span class="token comment">; 第一个数字是1</span>
  400f0e:   <span class="token number">74</span> <span class="token number">20</span>                   je     400f30 <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x34</span><span class="token operator">></span>
  400f10:   e8 <span class="token number">25</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400f15:   eb <span class="token number">19</span>                   jmp    400f30 <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x34</span><span class="token operator">></span>
  400f17:   8b <span class="token number">43</span> fc                mov    <span class="token operator">-</span><span class="token number">0x4</span>(<span class="token operator">%</span><span class="token register variable">rbx</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  400f1a:   <span class="token number">01</span> c0                   add    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f1c:   <span class="token number">39</span> <span class="token number">03</span>                   cmp    <span class="token operator">%</span><span class="token register variable">eax</span>,(<span class="token operator">%</span><span class="token register variable">rbx</span>)
  400f1e:   <span class="token number">74</span> <span class="token number">05</span>                   je     400f25 <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span>
  400f20:   e8 <span class="token number">15</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400f25:   <span class="token number">48</span> <span class="token number">83</span> c3 <span class="token number">04</span>             add    <span class="token operator">$</span><span class="token number">0x4</span>,<span class="token operator">%</span><span class="token register variable">rbx</span>
  400f29:   <span class="token number">48</span> <span class="token number">39</span> eb                cmp    <span class="token operator">%</span><span class="token register variable">rbp</span>,<span class="token operator">%</span><span class="token register variable">rbx</span>
  400f2c:   <span class="token number">75</span> e9                   jne    400f17 <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x1b</span><span class="token operator">></span>
  400f2e:   eb 0c                   jmp    400f3c <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x40</span><span class="token operator">></span>
  400f30:   <span class="token number">48</span> <span class="token number">8d</span> 5c <span class="token number">24</span> <span class="token number">04</span>          lea    <span class="token number">0x4</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rbx</span>
  400f35:   <span class="token number">48</span> <span class="token number">8d</span> 6c <span class="token number">24</span> <span class="token number">18</span>          lea    <span class="token number">0x18</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rbp</span>
  COMMENT <span class="token comment">; 边界，循环结束的标志</span>
  400f3a:   eb db                   jmp    400f17 <span class="token operator">&lt;</span>phase_2<span class="token operator">+</span><span class="token number">0x1b</span><span class="token operator">></span>
  400f3c:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">28</span>             add    <span class="token operator">$</span><span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400f40:   5b                      pop    <span class="token operator">%</span><span class="token register variable">rbx</span>
  400f41:   <span class="token number">5d</span>                      pop    <span class="token operator">%</span><span class="token register variable">rbp</span>
  400f42:   c3                      ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-1"><a href="#分析过程-1" class="headerlink" title="分析过程"></a>分析过程</h3><p><code>400f05</code>中，调用了一个获得6个数字的函数<code>read_six_numbers</code>，之后将对这六个数字进行操作。</p>
<p><code>400f0a</code>后，比较了此时在栈底的<code>%rsp</code>里面的值和<code>1</code>，如果相等就跳到<code>400f30</code>，防止炸弹爆炸。显然，<code>%rsp</code>的值就是<code>1</code>。</p>
<p><code>400f30</code>后，<code>%rbx</code>指向的是<code>%rsp</code>往上4个位置，<code>%rbp</code>指向的是<code>%rsp</code>往上18个位置，然后跳转到<code>400f17</code>。</p>
<p>在<code>400f17</code>，<code>%rbx</code>向下移动4个位置的值存储在<code>%eax</code>当中，此时就是<code>%rsp</code>的值，为<code>1</code>。之后<code>%eax</code>的值翻倍，并且判断其值是否就是<code>%rbx</code>.由于翻倍后的<code>%eax</code>的值是<code>2</code>，因此<code>%rbx</code>的值也应该是<code>2</code>。</p>
<p>接着两个值的确相同的话，跳转到<code>400f25</code>，<code>%rbx</code>向上移动4个单位，比较此时<code>%rbx</code>和<code>%rbq</code>。这里分为两个分支：如果相同跳转到<code>400f3c</code>，反之跳转到<code>400f17</code>。我们不妨先来分析不相同的情况。</p>
<p><code>400f17</code>其实已经在上文分析过了，通过刚刚的规律可以知道，这个时候<code>%rbx</code>里面的值总是<code>%rbx</code>往下4个单位里面的值的两倍，因此从栈底到栈顶的方向，我们就知道有这样一串等比数列：</p>
<p><code>1 2 4 8 16 32 ...</code></p>
<p>那到底什么时候结束呢？很显然通过<code>read_six_numbers</code>可以知道，我们只要6个数字。这时候又有一个问题：是递增的序列输入还是递减的序列输入呢？我们知道每个新的数字都要是<strong>前一个</strong>数字的两倍，因此一定是递增数列。投机取巧的方法就是都试一遍，哪个不会炸那个就是对的了。</p>
<p>因此答案是：</p>
<p><strong><code>1 2 4 8 16 32</code></strong></p>
<h3 id="伪代码-1"><a href="#伪代码-1" class="headerlink" title="伪代码"></a>伪代码</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">phase_2</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">read_six_numbers</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> a<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            The bomb explodes<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    The bomb is defused<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="运行截图-1"><a href="#运行截图-1" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/13/4rfZhIgwNKpRmTv.png" alt="phase_2.png"></p>
<hr>
<h2 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase 3"></a>Phase 3</h2><h3 id="汇编代码-2"><a href="#汇编代码-2" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">0000000000400f43 <span class="token operator">&lt;</span>phase_3<span class="token operator">></span>:
  400f43:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">18</span>             sub    <span class="token operator">$</span><span class="token number">0x18</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400f47:   <span class="token number">48</span> <span class="token number">8d</span> 4c <span class="token number">24</span> 0c          lea    <span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rcx</span>
  400f4c:   <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">54</span> <span class="token number">24</span> <span class="token number">08</span>          lea    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  400f51:   be cf <span class="token number">25</span> <span class="token number">40</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x4025cf</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  400f56:   b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f5b:   e8 <span class="token number">90</span> fc ff ff          call   400bf0 <span class="token operator">&lt;</span>__isoc99_sscanf@plt<span class="token operator">></span>
  400f60:   <span class="token number">83</span> f8 <span class="token number">01</span>                cmp    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f63:   7f <span class="token number">05</span>                   jg     400f6a <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x27</span><span class="token operator">></span>
  400f65:   e8 d0 <span class="token number">04</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400f6a:   <span class="token number">83</span> 7c <span class="token number">24</span> <span class="token number">08</span> <span class="token number">07</span>          cmpl   <span class="token operator">$</span><span class="token number">0x7</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  400f6f:   <span class="token number">77</span> 3c                   ja     400fad <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x6a</span><span class="token operator">></span>
  400f71:   8b <span class="token number">44</span> <span class="token number">24</span> <span class="token number">08</span>             mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  400f75:   ff <span class="token number">24</span> c5 <span class="token number">70</span> <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>    jmp    <span class="token operator">*</span><span class="token number">0x402470</span>(,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">8</span>)
  400f7c:   b8 cf <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0xcf</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f81:   eb 3b                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400f83:   b8 c3 <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x2c3</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f88:   eb <span class="token number">34</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400f8a:   b8 <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x100</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f8f:   eb <span class="token number">2d</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400f91:   b8 <span class="token number">85</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x185</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f96:   eb <span class="token number">26</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400f98:   b8 ce <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0xce</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400f9d:   eb 1f                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400f9f:   b8 aa <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x2aa</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fa4:   eb <span class="token number">18</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400fa6:   b8 <span class="token number">47</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x147</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fab:   eb <span class="token number">11</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400fad:   e8 <span class="token number">88</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400fb2:   b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fb7:   eb <span class="token number">05</span>                   jmp    400fbe <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  400fb9:   b8 <span class="token number">37</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x137</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fbe:   3b <span class="token number">44</span> <span class="token number">24</span> 0c             cmp    <span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  400fc2:   <span class="token number">74</span> <span class="token number">05</span>                   je     400fc9 <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">0x86</span><span class="token operator">></span>
  400fc4:   e8 <span class="token number">71</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  400fc9:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">18</span>             add    <span class="token operator">$</span><span class="token number">0x18</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400fcd:   c3                      ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-2"><a href="#分析过程-2" class="headerlink" title="分析过程"></a>分析过程</h3><p>前面两个炸弹都可以干看看出答案，但是第三个往后明显就困难多了。往后的炸弹我们很难逐条分析汇编代码来分析功能，现在开始我们使用gdb断点来帮助我们了解程序功能。</p>
<p>我们总体上要关注每次出现<code>explode_bomb</code>这个函数前程序做了什么，有助于理解我们传入的参数需要满足什么条件。</p>
<p><code>400f5b</code>的<code>__isoc99_sscanf@plt</code>函数长得非常奇怪，我们可以使用如下指令去看看其到底是做什么的。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gdb bomb
b <span class="token number">89</span> <span class="token comment"># 在 bomb.c 中，这是进入 phase_3 的入口</span>
run ans.txt <span class="token comment"># 第一和第二个炸弹的答案已经保存了</span>
<span class="token builtin class-name">test</span>
stepi
<span class="token punctuation">..</span>. <span class="token comment"># 跳过好多条汇编代码</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最终展现如下信息：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">__GI___isoc99_sscanf <span class="token punctuation">(</span>s<span class="token operator">=</span>0x603820 <span class="token operator">&lt;</span>input_strings+16<span class="token operator"><span class="token file-descriptor important">0</span>></span> <span class="token string">"test"</span>, <span class="token assign-left variable">format</span><span class="token operator">=</span>0x4025cf <span class="token string">"%d %d"</span><span class="token punctuation">)</span> at ./stdio-common/isoc99_sscanf.c:24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>说明第三个炸弹需要我们传入两个整型。</p>
<p>我们将<code>ans.txt</code>随意传入两个整数<code>22 23</code>。</p>
<p>使用<code>stepi</code> <code>nexti</code> <code>finish</code> <code>disas</code>等指令，当跳转到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400f63</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span>:    jg     <span class="token number">0x400f6a</span> <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们很好奇这上一行<code>400f60</code>中的<code>%eax</code>的值是多少，因为只有这个值比1大，炸弹才不会爆炸。那么我们用<code>info r</code>或者<code>p $eax</code>查看一下寄存器的值，发现是<code>2</code>。大胆猜测，这个值实际上是<code>sscanf</code>的返回值，意味着我们传入了两个参数。验证的方法也很简单，只需要在拆除第三个炸弹时只传入一个参数，这时候确实爆炸了，而且<code>$eax</code>值为<code>1</code>。</p>
<p>让我们仍然传入两个参数<code>22 23</code>。</p>
<p>当运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400f6a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span>:    cmpl   <span class="token operator">$</span><span class="token number">0x7</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们可以检查一下<code>0x8(%rsp)</code>是什么，因为接下来就要进行函数跳转了。运用命令，得：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/d <span class="token punctuation">(</span><span class="token variable">$rsp</span> + <span class="token number">8</span><span class="token punctuation">)</span>
0x7fffffffd678: <span class="token number">22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这个<code>22</code>就是我们传入的第一个参数！这个数值一旦比<code>7</code>来得大，就会跳转到<code>400fad</code>，炸弹爆炸。因此我们第一个参数必须小于等于<code>7</code>！我们修改第一个参数为<code>5</code>重新实验。运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400fb9</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">118</span><span class="token operator">></span>:   mov    <span class="token operator">$</span><span class="token number">0x137</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000400fbe</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">123</span><span class="token operator">></span>:   cmp    <span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000400fc2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">127</span><span class="token operator">></span>:   je     <span class="token number">0x400fc9</span> <span class="token operator">&lt;</span>phase_3<span class="token operator">+</span><span class="token number">134</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>我们又不由自主关心起<code>0xc(%rsp)</code>和<code>%eax</code>是什么，因为<code>0xc(%rsp)</code>的值如果不是<code>0x137</code>就会引爆炸弹。我们发现：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">206</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x /d <span class="token punctuation">(</span><span class="token variable">$rsp</span> + 0xc<span class="token punctuation">)</span>
0x7fffffffd67c: <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这说明炸弹会引爆。我们需要回去逐行分析代码找出规律了。运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400f71</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">46</span><span class="token operator">></span>:    mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>%eax</code>存放了<code>0x8(%rsp)</code>的值，即上文提到的第一个参数值。接下来运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400f98</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">85</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0xce</span>,<span class="token operator">%</span><span class="token register variable">eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个时候把<code>0xce</code> <code>(206)</code>赋值给<code>%eax</code>，和我们那次即将引爆炸弹的<code>%eax</code>值相等。那我刚刚的分析好像显得有些多余了？？？</p>
<p>再看这条指令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x /d <span class="token punctuation">(</span><span class="token variable">$rsp</span> + 0xc<span class="token punctuation">)</span>
0x7fffffffd67c: <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我们似乎并不清楚这里的<code>2</code>是什么含义，但我瞬间有一种很不好的预感：在第二个炸弹的时候，我直接用 <strong>Windows 下的 VS Code</strong> 编辑我的<code>ans.txt</code>，结果答案正确输入了，炸弹还是爆炸。于是我换成了 <strong>Vim</strong> 重新编辑了我的答案，炸弹就正常拆除了。我第二个参数传入的是23，我很合理的怀疑这里的<code>2</code>实际上应该是<code>23</code>。于是我抛弃 VS Code ，再重新编辑，这一次我再查看<code>($rsp + 0xc)</code>，结果就符合我的意图了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x /d <span class="token punctuation">(</span><span class="token variable">$rsp</span> + 0xc<span class="token punctuation">)</span>
0x7fffffffd67c: <span class="token number">23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我很难排查到究竟是什么原因导致了 Linux 和 Windows 上的格式差距，但这个例子提醒我：<strong>尽量在 Linux 环境下进行编辑修改，以免产生不必要的格式方面的麻烦</strong>。</p>
<p>那么我这次使用 <strong>Vim</strong> 修改了答案为<code>5 206</code>，炸弹就被拆除了。</p>
<p>实际上，第二个参数不总是<code>206</code>。当我把第一个参数换成别的值的时候，如果不改变第二个值，炸弹会爆炸。因此两个参数存在某种神奇的关系。但是我们只要能拆除炸弹就好了，所以关系是什么并不重要。</p>
<p>其实这么多的<code>jmp</code>，让我感觉到这个程序实际上实现了<code>switch</code>的功能。</p>
<p>最终答案是：</p>
<p><strong><code>5 206</code></strong></p>
<h3 id="伪代码-2"><a href="#伪代码-2" class="headerlink" title="伪代码"></a>伪代码</h3><p>仅仅是伪代码，忽略语法错误。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">phase_3</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        The bomb explodes<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 当 argv[0] == 5 的时候，argv[1] == 206，不会爆炸。</span>
    <span class="token comment">// 但是我并不知道这两个参数之间有什么关系，总之这样子可以拆除炸弹。</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">7</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
        The bomb is defused；
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="运行截图-2"><a href="#运行截图-2" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/13/eAidJQslZ71PSgF.png" alt="phase_3.png"></p>
<hr>
<h2 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase 4"></a>Phase 4</h2><h3 id="汇编代码-3"><a href="#汇编代码-3" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">0000000000400fce <span class="token operator">&lt;</span>func4<span class="token operator">></span>:
  400fce:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">08</span>             sub    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  400fd2:   <span class="token number">89</span> d0                   mov    <span class="token operator">%</span><span class="token register variable">edx</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fd4:   <span class="token number">29</span> f0                   sub    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fd6:   <span class="token number">89</span> c1                   mov    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  400fd8:   c1 e9 1f                shr    <span class="token operator">$</span><span class="token number">0x1f</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  400fdb:   <span class="token number">01</span> c8                   add    <span class="token operator">%</span><span class="token register variable">ecx</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fdd:   d1 f8                   sar    <span class="token number">$1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400fdf:   <span class="token number">8d</span> 0c <span class="token number">30</span>                lea    (<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">ecx</span>
  400fe2:   <span class="token number">39</span> f9                   cmp    <span class="token operator">%</span><span class="token register variable">edi</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  400fe4:   7e 0c                   jle    400ff2 <span class="token operator">&lt;</span>func4<span class="token operator">+</span><span class="token number">0x24</span><span class="token operator">></span>
  400fe6:   <span class="token number">8d</span> <span class="token number">51</span> ff                lea    <span class="token operator">-</span><span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rcx</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
  400fe9:   e8 e0 ff ff ff          call   400fce <span class="token operator">&lt;</span>func4<span class="token operator">></span>
  400fee:   <span class="token number">01</span> c0                   add    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400ff0:   eb <span class="token number">15</span>                   jmp    <span class="token number">401007</span> <span class="token operator">&lt;</span>func4<span class="token operator">+</span><span class="token number">0x39</span><span class="token operator">></span>
  400ff2:   b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  400ff7:   <span class="token number">39</span> f9                   cmp    <span class="token operator">%</span><span class="token register variable">edi</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  400ff9:   <span class="token number">7d</span> 0c                   jge    <span class="token number">401007</span> <span class="token operator">&lt;</span>func4<span class="token operator">+</span><span class="token number">0x39</span><span class="token operator">></span>
  400ffb:   <span class="token number">8d</span> <span class="token number">71</span> <span class="token number">01</span>                lea    <span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rcx</span>),<span class="token operator">%</span><span class="token register variable">esi</span>
  400ffe:   e8 cb ff ff ff          call   400fce <span class="token operator">&lt;</span>func4<span class="token operator">></span>
  <span class="token number">401003</span>:   <span class="token number">8d</span> <span class="token number">44</span> <span class="token number">00</span> <span class="token number">01</span>             lea    <span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401007</span>:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">08</span>             add    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  40100b:   c3                      ret

000000000040100c <span class="token operator">&lt;</span>phase_4<span class="token operator">></span>:
  40100c:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">18</span>             sub    <span class="token operator">$</span><span class="token number">0x18</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401010</span>:   <span class="token number">48</span> <span class="token number">8d</span> 4c <span class="token number">24</span> 0c          lea    <span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rcx</span>
  <span class="token number">401015</span>:   <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">54</span> <span class="token number">24</span> <span class="token number">08</span>          lea    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  40101a:   be cf <span class="token number">25</span> <span class="token number">40</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x4025cf</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  40101f:   b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401024</span>:   e8 c7 fb ff ff          call   400bf0 <span class="token operator">&lt;</span>__isoc99_sscanf@plt<span class="token operator">></span>
  <span class="token number">401029</span>:   <span class="token number">83</span> f8 <span class="token number">02</span>                cmp    <span class="token operator">$</span><span class="token number">0x2</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40102c:   <span class="token number">75</span> <span class="token number">07</span>                   jne    <span class="token number">401035</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span>
  40102e:   <span class="token number">83</span> 7c <span class="token number">24</span> <span class="token number">08</span> 0e          cmpl   <span class="token operator">$</span><span class="token number">0xe</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  <span class="token number">401033</span>:   <span class="token number">76</span> <span class="token number">05</span>                   jbe    40103a <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">0x2e</span><span class="token operator">></span>
  <span class="token number">401035</span>:   e8 <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  40103a:   ba 0e <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0xe</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  40103f:   be <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  <span class="token number">401044</span>:   8b 7c <span class="token number">24</span> <span class="token number">08</span>             mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">edi</span>
  <span class="token number">401048</span>:   e8 <span class="token number">81</span> ff ff ff          call   400fce <span class="token operator">&lt;</span>func4<span class="token operator">></span>
  <span class="token number">40104d</span>:   <span class="token number">85</span> c0                   test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40104f:   <span class="token number">75</span> <span class="token number">07</span>                   jne    <span class="token number">401058</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">0x4c</span><span class="token operator">></span>
  <span class="token number">401051</span>:   <span class="token number">83</span> 7c <span class="token number">24</span> 0c <span class="token number">00</span>          cmpl   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  <span class="token number">401056</span>:   <span class="token number">74</span> <span class="token number">05</span>                   je     <span class="token number">40105d</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">0x51</span><span class="token operator">></span>
  <span class="token number">401058</span>:   e8 dd <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  <span class="token number">40105d</span>:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">18</span>             add    <span class="token operator">$</span><span class="token number">0x18</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401061</span>:   c3                      ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-3"><a href="#分析过程-3" class="headerlink" title="分析过程"></a>分析过程</h3><p>使用和上题一样的方法，发现：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">__GI___isoc99_sscanf (s<span class="token operator">=</span><span class="token number">0x603870</span> <span class="token operator">&lt;</span>input_strings<span class="token operator">+</span><span class="token number">240</span><span class="token operator">></span> <span class="token string">"3"</span>, format<span class="token operator">=</span><span class="token number">0x4025cf</span> <span class="token string">"%d %d"</span>) at .<span class="token operator">/</span>stdio<span class="token operator">-</span>common<span class="token operator">/</span>isoc99_sscanf.c:<span class="token number">24</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>传入的是两个整型。那我们先输入<code>22 23</code>。再次运行，观察如下代码：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">0x0000000000401029 <span class="token operator">&lt;</span>+2<span class="token operator"><span class="token file-descriptor important">9</span>></span>:    <span class="token function">cmp</span>    <span class="token variable">$0x2</span>,%eax
0x000000000040102c <span class="token operator">&lt;</span>+3<span class="token operator"><span class="token file-descriptor important">2</span>></span>:    jne    0x401035 <span class="token operator">&lt;</span>phase_4+4<span class="token operator"><span class="token file-descriptor important">1</span>></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这里<code>%eax</code>一定要和<code>0x2</code>相等，否则就爆炸了。因此查看一下<code>%eax</code>的值：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>再次大胆猜测这里<code>%eax</code>就是传入的参数数量。当输入一个参数时，<code>%eax</code>为<code>1</code>，猜想大概率是正确的。再往下看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040102e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">34</span><span class="token operator">></span>:    cmpl   <span class="token operator">$</span><span class="token number">0xe</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
<span class="token number">0x0000000000401033</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span>:    jbe    <span class="token number">0x40103a</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">46</span><span class="token operator">></span>
<span class="token number">0x0000000000401035</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>我们要保证<code>0x8(%rsp)</code>的值要小于等于<code>0xe</code>。因此查看一下<code>0x8(%rsp)</code>。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) p (<span class="token operator">$</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">8</span>)
<span class="token number">$1</span> <span class="token operator">=</span> (void <span class="token operator">*</span>) <span class="token number">0x7fffffffd698</span>
(gdb) p <span class="token operator">*</span>(int <span class="token operator">*</span>)(<span class="token operator">$</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">8</span>)
<span class="token number">$2</span> <span class="token operator">=</span> <span class="token number">22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>就是我们的第一个参数，那么我们把第一个参数改小一点，改成<code>10</code>。然后再往下，不妨把断点打在<code>*0x000000000040103a</code>：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401048</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">60</span><span class="token operator">></span>:    call   <span class="token number">0x400fce</span> <span class="token operator">&lt;</span>func4<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>要进入<code>func4</code>了，我们<code>stepi</code>一下，往里看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000400fe2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">20</span><span class="token operator">></span>:    cmp    <span class="token operator">%</span><span class="token register variable">edi</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
<span class="token number">0x0000000000400fe4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">22</span><span class="token operator">></span>:    jle    <span class="token number">0x400ff2</span> <span class="token operator">&lt;</span>func4<span class="token operator">+</span><span class="token number">36</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>%ecx</code>要小于等于<code>%edi</code>，查看一下这两个：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$edi</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$ecx</span>
<span class="token variable">$4</span> <span class="token operator">=</span> <span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>%edi</code>我们显然知道是第一个参数，那<code>%ecx</code>呢？但是此时是满足条件的，我们接着往下走。走多一点吧，中间并没有引爆炸弹的代码，我们放心往下走。这个时候我们跳回到了<code>phase_4</code>，看看这几行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040104d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">65</span><span class="token operator">></span>:    test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040104f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">67</span><span class="token operator">></span>:    jne    <span class="token number">0x401058</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">76</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这个时候<code>%eax</code>一定要是0。查看一下<code>%eax</code>：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) p <span class="token operator">$</span><span class="token register variable">eax</span>
<span class="token number">$5</span> <span class="token operator">=</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>很明显不符合我们的要求。这个时候我们得去看看我们这之前的代码了。可不可以不管<code>func4</code>，从前面发现一点规律呢？比如会不会有哪个寄存器的值就是5？看这几行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">40103a: ba 0e <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0xe</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
40103f: be <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
<span class="token number">401044</span>: 8b 7c <span class="token number">24</span> <span class="token number">08</span>             mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">edi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查看一下这几个寄存器的值：<code>%edx</code>肯定是<code>0xe</code>，<code>%esi</code>肯定是<code>0</code>。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) p <span class="token operator">$</span><span class="token register variable">edi</span>
<span class="token number">$1</span> <span class="token operator">=</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>说明把第一个参数给了<code>0x8(%rsp)</code>。不妨试一下把第二个参数改成<code>0</code>或者是<code>0xe</code>？把断点打在<code>*0x40104d</code>。先试试<code>0</code>，失败了。再试试<code>0xe</code>，也失败了。代码都是卡在之前一样的跳转的位置，说明和第二个参数没有关系。那么再把第一个参数改成<code>0</code>或者<code>e</code>？先试试<code>0 23</code>。这一次通过了原来的比较，查看一下<code>%eax</code>：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) p <span class="token operator">$</span><span class="token register variable">eax</span>
<span class="token number">$1</span> <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>嗯，确实符合预期了。接下来看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">401051</span>: <span class="token number">83</span> 7c <span class="token number">24</span> 0c <span class="token number">00</span>          cmpl   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
<span class="token number">401056</span>: <span class="token number">74</span> <span class="token number">05</span>                   je     <span class="token number">40105d</span> <span class="token operator">&lt;</span>phase_4<span class="token operator">+</span><span class="token number">0x51</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>查看一下<code>0xc(%rsp)</code>，确保其就是<code>0</code>，炸弹才不会爆炸。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) x<span class="token operator">/</span>d <span class="token operator">$</span><span class="token register variable">rsp</span> <span class="token operator">+</span> <span class="token number">12</span>
<span class="token number">0x7fffffffd69c</span>: <span class="token number">23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>正好是我们第二个参数！我们只要把第二个参数改成<code>0</code>，炸弹就拆除了。</p>
<p>这种解法其实又有点投机取巧，因为我们根本没有分析<code>func4</code>的功能，只是有些盲目地给第一个或者第二个参数赋值为<code>0</code>或者<code>14</code>。</p>
<p>最终答案是：</p>
<p><strong><code>0 0</code></strong></p>
<h3 id="运行截图-3"><a href="#运行截图-3" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/13/BskvmIge45TuS1f.png" alt="phase_4.png"></p>
<hr>
<h2 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase 5"></a>Phase 5</h2><h3 id="汇编代码-4"><a href="#汇编代码-4" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0000000000401062</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">></span>:
  <span class="token number">401062</span>:   <span class="token number">53</span>                      push   <span class="token operator">%</span><span class="token register variable">rbx</span>
  <span class="token number">401063</span>:   <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">20</span>             sub    <span class="token operator">$</span><span class="token number">0x20</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401067</span>:   <span class="token number">48</span> <span class="token number">89</span> fb                mov    <span class="token operator">%</span><span class="token register variable">rdi</span>,<span class="token operator">%</span><span class="token register variable">rbx</span>
  40106a:   <span class="token number">64</span> <span class="token number">48</span> 8b <span class="token number">04</span> <span class="token number">25</span> <span class="token number">28</span> <span class="token number">00</span>    mov    <span class="token operator">%</span><span class="token register variable">fs</span>:<span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">401071</span>:   <span class="token number">00</span> <span class="token number">00</span> 
  <span class="token number">401073</span>:   <span class="token number">48</span> <span class="token number">89</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">18</span>          mov    <span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">0x18</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  <span class="token number">401078</span>:   <span class="token number">31</span> c0                   xor    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40107a:   e8 9c <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>          call   40131b <span class="token operator">&lt;</span>string_length<span class="token operator">></span>
  40107f:   <span class="token number">83</span> f8 <span class="token number">06</span>                cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401082</span>:   <span class="token number">74</span> 4e                   je     4010d2 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x70</span><span class="token operator">></span>
  <span class="token number">401084</span>:   e8 b1 <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  <span class="token number">401089</span>:   eb <span class="token number">47</span>                   jmp    4010d2 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x70</span><span class="token operator">></span>
  40108b:   0f b6 0c <span class="token number">03</span>             movzbl (<span class="token operator">%</span><span class="token register variable">rbx</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">ecx</span>
  40108f:   <span class="token number">88</span> 0c <span class="token number">24</span>                mov    <span class="token operator">%</span><span class="token register variable">cl</span>,(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  <span class="token number">401092</span>:   <span class="token number">48</span> 8b <span class="token number">14</span> <span class="token number">24</span>             mov    (<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  <span class="token number">401096</span>:   <span class="token number">83</span> e2 0f                and    <span class="token operator">$</span><span class="token number">0xf</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401099</span>:   0f b6 <span class="token number">92</span> b0 <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>    movzbl <span class="token number">0x4024b0</span>(<span class="token operator">%</span><span class="token register variable">rdx</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
  4010a0:   <span class="token number">88</span> <span class="token number">54</span> <span class="token number">04</span> <span class="token number">10</span>             mov    <span class="token operator">%</span><span class="token register variable">dl</span>,<span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>)
  4010a4:   <span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">01</span>             add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  4010a8:   <span class="token number">48</span> <span class="token number">83</span> f8 <span class="token number">06</span>             cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  4010ac:   <span class="token number">75</span> dd                   jne    40108b <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span>
  4010ae:   c6 <span class="token number">44</span> <span class="token number">24</span> <span class="token number">16</span> <span class="token number">00</span>          movb   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0x16</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  4010b3:   be 5e <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x40245e</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  4010b8:   <span class="token number">48</span> <span class="token number">8d</span> 7c <span class="token number">24</span> <span class="token number">10</span>          lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
  4010bd:   e8 <span class="token number">76</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>          call   <span class="token number">401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
  4010c2:   <span class="token number">85</span> c0                   test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  4010c4:   <span class="token number">74</span> <span class="token number">13</span>                   je     4010d9 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x77</span><span class="token operator">></span>
  4010c6:   e8 6f <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>          call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  4010cb:   0f 1f <span class="token number">44</span> <span class="token number">00</span> <span class="token number">00</span>          nopl   <span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>)
  4010d0:   eb <span class="token number">07</span>                   jmp    4010d9 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x77</span><span class="token operator">></span>
  4010d2:   b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>          mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  4010d7:   eb b2                   jmp    40108b <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span>
  4010d9:   <span class="token number">48</span> 8b <span class="token number">44</span> <span class="token number">24</span> <span class="token number">18</span>          mov    <span class="token number">0x18</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rax</span>
  4010de:   <span class="token number">64</span> <span class="token number">48</span> <span class="token number">33</span> <span class="token number">04</span> <span class="token number">25</span> <span class="token number">28</span> <span class="token number">00</span>    xor    <span class="token operator">%</span><span class="token register variable">fs</span>:<span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">4010e5</span>:   <span class="token number">00</span> <span class="token number">00</span> 
  <span class="token number">4010e7</span>:   <span class="token number">74</span> <span class="token number">05</span>                   je     4010ee <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x8c</span><span class="token operator">></span>
  <span class="token number">4010e9</span>:   e8 <span class="token number">42</span> fa ff ff          call   400b30 <span class="token operator">&lt;</span>__stack_chk_fail@plt<span class="token operator">></span>
  4010ee:   <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">20</span>             add    <span class="token operator">$</span><span class="token number">0x20</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  4010f2:   5b                      pop    <span class="token operator">%</span><span class="token register variable">rbx</span>
  4010f3:   c3                      ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-4"><a href="#分析过程-4" class="headerlink" title="分析过程"></a>分析过程</h3><p>先在<code>line 101</code>打断点，进入程序，随便输入个<code>2asdsads</code>。看到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040107a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span>:    call   <span class="token number">0x40131b</span> <span class="token operator">&lt;</span>string_length<span class="token operator">></span>
<span class="token number">0x000000000040107f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">29</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401082</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span>:    je     <span class="token number">0x4010d2</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">112</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这里说明<code>%eax</code>要和<code>6</code>相等，我们看看<code>%eax</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这刚好是<code>2asdsads</code>的长度，可以推测函数<code>string_length</code>修改了<code>%eax</code>，我们需要确保输入的字符串长度是<code>6</code>。于是改成输入<code>asdfgh</code>。来到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010a8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">70</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
<span class="token number">0x00000000004010ac</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">74</span><span class="token operator">></span>:    jne    <span class="token number">0x40108b</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果<code>%rax</code>的值不是<code>6</code>，就会跳回<code>phase_5+41</code>。我们看看<code>%rax</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$rax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>的确不是。那让程序继续运行。运行了很久很久之后，我们再检查一下<code>%rax</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$rax</span>
<span class="token variable">$2</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>来到如下代码区域：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010bd</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">91</span><span class="token operator">></span>:    call   <span class="token number">0x401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
<span class="token number">0x00000000004010c2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">96</span><span class="token operator">></span>:    test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x00000000004010c4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">98</span><span class="token operator">></span>:    je     <span class="token number">0x4010d9</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">119</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>说明<code>%eax</code>必须是<code>0</code>，否则爆炸。因此查看一下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>会爆炸，我们要找寻一下原因。我们是否应该回去想想<code>strings_not_equal</code>是拿来干什么的？重新运行一下试试：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010ae</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">76</span><span class="token operator">></span>:    movb   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0x16</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
<span class="token number">0x00000000004010b3</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">81</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x40245e</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
<span class="token number">0x00000000004010b8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">86</span><span class="token operator">></span>:    lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x00000000004010bd</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">91</span><span class="token operator">></span>:    call   <span class="token number">0x401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行到<code>&lt;+91&gt;</code>了，我们很有必要查看一下<code>0x10(%rsp)</code>和<code>0x40245e</code>都有些什么。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s 0x40245e
0x40245e:       <span class="token string">"flyers"</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s <span class="token variable">$rsp</span> + <span class="token number">16</span>
0x7fffffffd9b0: <span class="token string">"auirsn"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这两个字符串都是长度为<code>6</code>，我们是不是该把我们的输入改成它们呢？先试试<code>&quot;flyers&quot;</code>。断点可以打在<code>*0x4010b8</code>了。然后查看一下<code>%eax</code>是多少：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那我们试试<code>&quot;auirsn&quot;</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>还是不行。那我们就很有必要对再往前的代码进行分析了。把断点打在<code>*0x4010d2</code>，然后分析如下代码：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">401089</span>: eb <span class="token number">47</span>                 jmp    4010d2 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x70</span><span class="token operator">></span>
40108b: 0f b6 0c <span class="token number">03</span>           movzbl (<span class="token operator">%</span><span class="token register variable">rbx</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">ecx</span>
40108f: <span class="token number">88</span> 0c <span class="token number">24</span>              mov    <span class="token operator">%</span><span class="token register variable">cl</span>,(<span class="token operator">%</span><span class="token register variable">rsp</span>)
<span class="token number">401092</span>: <span class="token number">48</span> 8b <span class="token number">14</span> <span class="token number">24</span>           mov    (<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
<span class="token number">401096</span>: <span class="token number">83</span> e2 0f              and    <span class="token operator">$</span><span class="token number">0xf</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">401099</span>: 0f b6 <span class="token number">92</span> b0 <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>  movzbl <span class="token number">0x4024b0</span>(<span class="token operator">%</span><span class="token register variable">rdx</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
4010a0: <span class="token number">88</span> <span class="token number">54</span> <span class="token number">04</span> <span class="token number">10</span>           mov    <span class="token operator">%</span><span class="token register variable">dl</span>,<span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>)
4010a4: <span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">01</span>           add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
4010a8: <span class="token number">48</span> <span class="token number">83</span> f8 <span class="token number">06</span>           cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
4010ac: <span class="token number">75</span> dd                 jne    40108b <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span>
4010ae: c6 <span class="token number">44</span> <span class="token number">24</span> <span class="token number">16</span> <span class="token number">00</span>        movb   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0x16</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
4010b3: be 5e <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x40245e</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
4010b8: <span class="token number">48</span> <span class="token number">8d</span> 7c <span class="token number">24</span> <span class="token number">10</span>        lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
4010bd: e8 <span class="token number">76</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>        call   <span class="token number">401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
4010c2: <span class="token number">85</span> c0                 test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
4010c4: <span class="token number">74</span> <span class="token number">13</span>                 je     4010d9 <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x77</span><span class="token operator">></span>
4010c6: e8 6f <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>

4010d2: b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
4010d7: eb b2                 jmp    40108b <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">0x29</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>观察可以知道，程序刚开始跳到了<code>4010d2</code>，之后又跳回上面的代码。我们有必要逐行分析一下。在<code>40108b</code>执行前查看一下<code>%rbx</code> <code>%rax</code> <code>%ecx</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$ecx</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">6</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s <span class="token punctuation">(</span><span class="token variable">$rax</span> + <span class="token variable">$rbx</span><span class="token punctuation">)</span>
0x6038c0 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">0</span>></span>:   <span class="token string">"asdfgh"</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span>
0x6038c0 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">0</span>></span>:   <span class="token number">97</span> <span class="token string">'a'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">1</span>
0x6038c1 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">1</span>></span>:   <span class="token number">115</span> <span class="token string">'s'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">2</span>
0x6038c2 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">2</span>></span>:   <span class="token number">100</span> <span class="token string">'d'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">3</span>
0x6038c3 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">3</span>></span>:   <span class="token number">102</span> <span class="token string">'f'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">4</span>
0x6038c4 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">4</span>></span>:   <span class="token number">103</span> <span class="token string">'g'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">5</span>
0x6038c5 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">5</span>></span>:   <span class="token number">104</span> <span class="token string">'h'</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span> + <span class="token number">6</span>
0x6038c6 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">6</span>></span>:   <span class="token number">0</span> <span class="token string">'\000'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>寄存器含义不言而喻，<code>$rbx</code>指向了输入的字符串的最低一位。执行后：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$ecx</span>
<span class="token variable">$4</span> <span class="token operator">=</span> <span class="token number">97</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>97</code>是什么？显然就是<code>a</code>的ASCII码，此时<code>%ecx</code>存放的是输入字符串的首位。其实也很好理解，我们把<code>(%rbx,%rax,1)</code>传给<code>%eax</code>。查看一下<code>%cl</code>（其实就是<code>%ecx</code>）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$cl</span>
<span class="token variable">$5</span> <span class="token operator">=</span> <span class="token number">97</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>再看到如下代码：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040108b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span>:    movzbl (<span class="token operator">%</span><span class="token register variable">rbx</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">ecx</span>
<span class="token number">0x000000000040108f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">45</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">cl</span>,(<span class="token operator">%</span><span class="token register variable">rsp</span>)
<span class="token number">0x0000000000401092</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">48</span><span class="token operator">></span>:    mov    (<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
<span class="token number">0x0000000000401096</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>:    and    <span class="token operator">$</span><span class="token number">0xf</span>,<span class="token operator">%</span><span class="token register variable">edx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里还是<code>a</code>的ASCII码。我们发现这个值最终传给了<code>%rdx</code>，并且让其与<code>1111</code>作按位与运算。由于<code>&#39;a&#39;</code>的二进制表示是<code>01100001</code>，按位与的结果应该就是<code>1</code>。我们验证一下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$rdx</span>
<span class="token variable">$12</span> <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>果然如此！因此这里的作用就是取<code>%rdx</code>的低4位。我们再往下看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401099</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">55</span><span class="token operator">></span>:    movzbl <span class="token number">0x4024b0</span>(<span class="token operator">%</span><span class="token register variable">rdx</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">0x00000000004010a0</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">62</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">dl</span>,<span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>)
<span class="token number">0x00000000004010a4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">66</span><span class="token operator">></span>:    add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
<span class="token number">0x00000000004010a8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">70</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
<span class="token number">0x00000000004010ac</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">74</span><span class="token operator">></span>:    jne    <span class="token number">0x40108b</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先好奇<code>0x4024b0(%rdx)</code>是什么。我们知道<code>%dl</code>实际上是<code>%edx</code>的低八位寄存器，所以此时里面的值应该和进行按位与运算后的<code>%edx</code>一样，它给到了<code>0x10(%rsp,%rax,1)</code>。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) x <span class="token number">0x4024b0</span>
<span class="token number">0x4024b0</span> <span class="token operator">&lt;</span>array<span class="token number">.3449</span><span class="token operator">></span>:  <span class="token string">"maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"</span>
(gdb) x <span class="token number">0x4024b0</span> <span class="token operator">+</span> <span class="token operator">$</span><span class="token register variable">rdx</span>
<span class="token number">0x4024b1</span> <span class="token operator">&lt;</span>array<span class="token number">.3449</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">></span>:        <span class="token string">"aduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>为什么要把<code>*0x4024b0</code>加上<code>%rdx</code>的值呢？我们知道<code>%rdx</code>实际上是我们刚刚输入的第一个字符的低4位，也就是要从<code>&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</code>这个字符串的第（输入的字符串的第一个字符的低4位）位，也就是第一位开始取，因此<code>0x4024b0 + $rdx</code>结果符合我们预期。我们可以推断，我们输入的字符串有取字符的作用。我们把取出来的字符存到<code>0x10(%rsp,%rax,1)</code>当中，这是一个全新的内存区域。能取到刚好是一个字符的原因是，<code>%dl</code>是<code>%edx</code>的低八位寄存器，刚好取到一个<code>char</code>类型的长度。这里的<code>$rax</code>有特定的用途，我们知道在之前：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010d2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">112</span><span class="token operator">></span>:   mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里<code>%eax</code>被置为0，因此可以知道如下的汇编代码实现了特定的功能，保证执行了六次：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010a4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">66</span><span class="token operator">></span>:    add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
<span class="token number">0x00000000004010a8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">70</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
<span class="token number">0x00000000004010ac</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">74</span><span class="token operator">></span>:    jne    <span class="token number">0x40108b</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>伪代码如下：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">goto</span><span class="token operator">:</span> <span class="token number">0x40108b</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>第二次循环，我们也可以继续观察。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$rax</span>
<span class="token variable">$37</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rbx</span>
0x6038c0 <span class="token operator">&lt;</span>input_strings+32<span class="token operator"><span class="token file-descriptor important">0</span>></span>:   <span class="token string">"asdfgh"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>之后，多亏了八位寄存器<code>%cl</code>，通过<code>%rax</code>的一次偏置，我们可以把字符串的第二个元素存入<code>%rdx</code>当中。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) p<span class="token operator">/</span>c <span class="token operator">$</span><span class="token register variable">dl</span>
<span class="token number">$48</span> <span class="token operator">=</span> <span class="token number">115</span> <span class="token string">'s'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>&#39;s&#39;</code>的低四位是<code>0011</code>，我们推测这一次能取到神秘字符串的第<code>3</code>位。我们试一试：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p/c <span class="token variable">$dl</span>
<span class="token variable">$50</span> <span class="token operator">=</span> <span class="token number">117</span> <span class="token string">'u'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>没错！<code>&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</code>第三位就是<code>u</code>！那我们继续看看运行到第六次之后，新开辟的内存空间<code>0x10(%rsp)</code>里面是不是存放着我们取出来的字符。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s <span class="token number">16</span> + <span class="token variable">$rsp</span>
0x7fffffffd9b0: <span class="token string">"auirsn"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>那么我们现在很明白我们输入的字符串会被怎么处理了：<strong>取出输入的字符串的每个字母的ASCII码的第八位，作为神秘字符串的索引，分别取出字符，存入一个新的内存区域当中</strong>。</p>
<p>接下来我们看看新的字符串要有什么用。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x00000000004010b3</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">81</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x40245e</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
<span class="token number">0x00000000004010b8</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">86</span><span class="token operator">></span>:    lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x00000000004010bd</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">91</span><span class="token operator">></span>:    call   <span class="token number">0x401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
<span class="token number">0x00000000004010c2</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">96</span><span class="token operator">></span>:    test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x00000000004010c4</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">98</span><span class="token operator">></span>:    je     <span class="token number">0x4010d9</span> <span class="token operator">&lt;</span>phase_5<span class="token operator">+</span><span class="token number">119</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里调用了一个<code>strings_not_equal</code>函数，很可能就是把我们新的字符串和某个字符串比较是否相等，如果相等就返回<code>0</code>，不相等返回<code>1</code>。我们在最开始已经分析过了，如果是<code>1</code>就爆炸了，因此两个字符串必须是相等的。我们知道：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s 0x40245e
0x40245e:       <span class="token string">"flyers"</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/s <span class="token variable">$rsp</span> + <span class="token number">16</span>
0x7fffffffd9b0: <span class="token string">"auirsn"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>那我们只要能取出<code>&quot;flyers&quot;</code>就能拆除炸弹了吧！我们来试试。对于<code>&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</code>，我们要取出第<code>9 15 14 5 6 7</code> (<code>1001 1111 1110 0101 0110 0111</code>)位即可。通过查询ASCII码表，我们可以试试输入字符串<code>&quot;yONEFG&quot;</code>，炸弹确实拆除了。最终答案就是：</p>
<p><strong><code>&quot;yONEFG&quot;</code></strong></p>
<h3 id="运行截图-4"><a href="#运行截图-4" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/14/AwjyF7LZvIgHQ43.png" alt="phase_5.png"></p>
<hr>
<h2 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase 6"></a>Phase 6</h2><h3 id="汇编代码-5"><a href="#汇编代码-5" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">00000000004010f4 <span class="token operator">&lt;</span>phase_6<span class="token operator">></span>:
  4010f4: <span class="token number">41</span> <span class="token number">56</span>                 push   <span class="token operator">%</span><span class="token register variable">r14</span>
  4010f6: <span class="token number">41</span> <span class="token number">55</span>                 push   <span class="token operator">%</span><span class="token register variable">r13</span>
  4010f8: <span class="token number">41</span> <span class="token number">54</span>                 push   <span class="token operator">%</span><span class="token register variable">r12</span>
  4010fa: <span class="token number">55</span>                    push   <span class="token operator">%</span><span class="token register variable">rbp</span>
  4010fb: <span class="token number">53</span>                    push   <span class="token operator">%</span><span class="token register variable">rbx</span>
  4010fc: <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">50</span>           sub    <span class="token operator">$</span><span class="token number">0x50</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401100</span>: <span class="token number">49</span> <span class="token number">89</span> e5              mov    <span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">r13</span>
  <span class="token number">401103</span>: <span class="token number">48</span> <span class="token number">89</span> e6              mov    <span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>
  <span class="token number">401106</span>: e8 <span class="token number">51</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        call   40145c <span class="token operator">&lt;</span>read_six_numbers<span class="token operator">></span>
  40110b: <span class="token number">49</span> <span class="token number">89</span> e6              mov    <span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">r14</span>
  40110e: <span class="token number">41</span> bc <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>     mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">r12d</span>
  <span class="token number">401114</span>: 4c <span class="token number">89</span> ed              mov    <span class="token operator">%</span><span class="token register variable">r13</span>,<span class="token operator">%</span><span class="token register variable">rbp</span>
  <span class="token number">401117</span>: <span class="token number">41</span> 8b <span class="token number">45</span> <span class="token number">00</span>           mov    <span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">r13</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  40111b: <span class="token number">83</span> e8 <span class="token number">01</span>              sub    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40111e: <span class="token number">83</span> f8 <span class="token number">05</span>              cmp    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401121</span>: <span class="token number">76</span> <span class="token number">05</span>                 jbe    <span class="token number">401128</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x34</span><span class="token operator">></span>
  <span class="token number">401123</span>: e8 <span class="token number">12</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  <span class="token number">401128</span>: <span class="token number">41</span> <span class="token number">83</span> c4 <span class="token number">01</span>           add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">r12d</span>
  40112c: <span class="token number">41</span> <span class="token number">83</span> fc <span class="token number">06</span>           cmp    <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token operator">%</span><span class="token register variable">r12d</span>
  <span class="token number">401130</span>: <span class="token number">74</span> <span class="token number">21</span>                 je     <span class="token number">401153</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x5f</span><span class="token operator">></span>
  <span class="token number">401132</span>: <span class="token number">44</span> <span class="token number">89</span> e3              mov    <span class="token operator">%</span><span class="token register variable">r12d</span>,<span class="token operator">%</span><span class="token register variable">ebx</span>
  <span class="token number">401135</span>: <span class="token number">48</span> <span class="token number">63</span> c3              movslq <span class="token operator">%</span><span class="token register variable">ebx</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">401138</span>: 8b <span class="token number">04</span> <span class="token number">84</span>              mov    (<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">4</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  40113b: <span class="token number">39</span> <span class="token number">45</span> <span class="token number">00</span>              cmp    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">rbp</span>)
  40113e: <span class="token number">75</span> <span class="token number">05</span>                 jne    <span class="token number">401145</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x51</span><span class="token operator">></span>
  <span class="token number">401140</span>: e8 f5 <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  <span class="token number">401145</span>: <span class="token number">83</span> c3 <span class="token number">01</span>              add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">ebx</span>
  <span class="token number">401148</span>: <span class="token number">83</span> fb <span class="token number">05</span>              cmp    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">ebx</span>
  40114b: 7e e8                 jle    <span class="token number">401135</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x41</span><span class="token operator">></span>
  <span class="token number">40114d</span>: <span class="token number">49</span> <span class="token number">83</span> c5 <span class="token number">04</span>           add    <span class="token operator">$</span><span class="token number">0x4</span>,<span class="token operator">%</span><span class="token register variable">r13</span>
  <span class="token number">401151</span>: eb c1                 jmp    <span class="token number">401114</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x20</span><span class="token operator">></span>
  <span class="token number">401153</span>: <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">74</span> <span class="token number">24</span> <span class="token number">18</span>        lea    <span class="token number">0x18</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rsi</span>
  <span class="token number">401158</span>: 4c <span class="token number">89</span> f0              mov    <span class="token operator">%</span><span class="token register variable">r14</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  40115b: b9 <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x7</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  <span class="token number">401160</span>: <span class="token number">89</span> ca                 mov    <span class="token operator">%</span><span class="token register variable">ecx</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401162</span>: 2b <span class="token number">10</span>                 sub    (<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401164</span>: <span class="token number">89</span> <span class="token number">10</span>                 mov    <span class="token operator">%</span><span class="token register variable">edx</span>,(<span class="token operator">%</span><span class="token register variable">rax</span>)
  <span class="token number">401166</span>: <span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">04</span>           add    <span class="token operator">$</span><span class="token number">0x4</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  40116a: <span class="token number">48</span> <span class="token number">39</span> f0              cmp    <span class="token operator">%</span><span class="token register variable">rsi</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">40116d</span>: <span class="token number">75</span> f1                 jne    <span class="token number">401160</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x6c</span><span class="token operator">></span>
  40116f: be <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  <span class="token number">401174</span>: eb <span class="token number">21</span>                 jmp    <span class="token number">401197</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xa3</span><span class="token operator">></span>
  <span class="token number">401176</span>: <span class="token number">48</span> 8b <span class="token number">52</span> <span class="token number">08</span>           mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rdx</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  40117a: <span class="token number">83</span> c0 <span class="token number">01</span>              add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">40117d</span>: <span class="token number">39</span> c8                 cmp    <span class="token operator">%</span><span class="token register variable">ecx</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40117f: <span class="token number">75</span> f5                 jne    <span class="token number">401176</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x82</span><span class="token operator">></span>
  <span class="token number">401181</span>: eb <span class="token number">05</span>                 jmp    <span class="token number">401188</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x94</span><span class="token operator">></span>
  <span class="token number">401183</span>: ba d0 <span class="token number">32</span> <span class="token number">60</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x6032d0</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401188</span>: <span class="token number">48</span> <span class="token number">89</span> <span class="token number">54</span> <span class="token number">74</span> <span class="token number">20</span>        mov    <span class="token operator">%</span><span class="token register variable">rdx</span>,<span class="token number">0x20</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>,<span class="token number">2</span>)
  <span class="token number">40118d</span>: <span class="token number">48</span> <span class="token number">83</span> c6 <span class="token number">04</span>           add    <span class="token operator">$</span><span class="token number">0x4</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>
  <span class="token number">401191</span>: <span class="token number">48</span> <span class="token number">83</span> fe <span class="token number">18</span>           cmp    <span class="token operator">$</span><span class="token number">0x18</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>
  <span class="token number">401195</span>: <span class="token number">74</span> <span class="token number">14</span>                 je     4011ab <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xb7</span><span class="token operator">></span>
  <span class="token number">401197</span>: 8b 0c <span class="token number">34</span>              mov    (<span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">rsi</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">ecx</span>
  40119a: <span class="token number">83</span> f9 <span class="token number">01</span>              cmp    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
  <span class="token number">40119d</span>: 7e e4                 jle    <span class="token number">401183</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x8f</span><span class="token operator">></span>
  40119f: b8 <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  4011a4: ba d0 <span class="token number">32</span> <span class="token number">60</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x6032d0</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  4011a9: eb cb                 jmp    <span class="token number">401176</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x82</span><span class="token operator">></span>
  4011ab: <span class="token number">48</span> 8b 5c <span class="token number">24</span> <span class="token number">20</span>        mov    <span class="token number">0x20</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rbx</span>
  4011b0: <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">28</span>        lea    <span class="token number">0x28</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rax</span>
  4011b5: <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">74</span> <span class="token number">24</span> <span class="token number">50</span>        lea    <span class="token number">0x50</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rsi</span>
  4011ba: <span class="token number">48</span> <span class="token number">89</span> d9              mov    <span class="token operator">%</span><span class="token register variable">rbx</span>,<span class="token operator">%</span><span class="token register variable">rcx</span>
  4011bd: <span class="token number">48</span> 8b <span class="token number">10</span>              mov    (<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  4011c0: <span class="token number">48</span> <span class="token number">89</span> <span class="token number">51</span> <span class="token number">08</span>           mov    <span class="token operator">%</span><span class="token register variable">rdx</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rcx</span>)
  4011c4: <span class="token number">48</span> <span class="token number">83</span> c0 <span class="token number">08</span>           add    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  4011c8: <span class="token number">48</span> <span class="token number">39</span> f0              cmp    <span class="token operator">%</span><span class="token register variable">rsi</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  4011cb: <span class="token number">74</span> <span class="token number">05</span>                 je     4011d2 <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xde</span><span class="token operator">></span>
  4011cd: <span class="token number">48</span> <span class="token number">89</span> d1              mov    <span class="token operator">%</span><span class="token register variable">rdx</span>,<span class="token operator">%</span><span class="token register variable">rcx</span>
  4011d0: eb eb                 jmp    4011bd <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xc9</span><span class="token operator">></span>
  4011d2: <span class="token number">48</span> c7 <span class="token number">42</span> <span class="token number">08</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>  movq   <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rdx</span>)
  4011d9: <span class="token number">00</span> 
  4011da: bd <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">ebp</span>
  4011df: <span class="token number">48</span> 8b <span class="token number">43</span> <span class="token number">08</span>           mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rbx</span>),<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">4011e3</span>: 8b <span class="token number">00</span>                 mov    (<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">4011e5</span>: <span class="token number">39</span> <span class="token number">03</span>                 cmp    <span class="token operator">%</span><span class="token register variable">eax</span>,(<span class="token operator">%</span><span class="token register variable">rbx</span>)
  <span class="token number">4011e7</span>: <span class="token number">7d</span> <span class="token number">05</span>                 jge    4011ee <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xfa</span><span class="token operator">></span>
  <span class="token number">4011e9</span>: e8 4c <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  4011ee: <span class="token number">48</span> 8b 5b <span class="token number">08</span>           mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rbx</span>),<span class="token operator">%</span><span class="token register variable">rbx</span>
  4011f2: <span class="token number">83</span> ed <span class="token number">01</span>              sub    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">ebp</span>
  4011f5: <span class="token number">75</span> e8                 jne    4011df <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0xeb</span><span class="token operator">></span>
  4011f7: <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">50</span>           add    <span class="token operator">$</span><span class="token number">0x50</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  4011fb: 5b                    pop    <span class="token operator">%</span><span class="token register variable">rbx</span>
  4011fc: <span class="token number">5d</span>                    pop    <span class="token operator">%</span><span class="token register variable">rbp</span>
  4011fd: <span class="token number">41</span> 5c                 pop    <span class="token operator">%</span><span class="token register variable">r12</span>
  4011ff: <span class="token number">41</span> <span class="token number">5d</span>                 pop    <span class="token operator">%</span><span class="token register variable">r13</span>
  <span class="token number">401201</span>: <span class="token number">41</span> 5e                 pop    <span class="token operator">%</span><span class="token register variable">r14</span>
  <span class="token number">401203</span>: c3                    ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-5"><a href="#分析过程-5" class="headerlink" title="分析过程"></a>分析过程</h3><p>代码很长，如果一条一条分析会很费时费力。我们尝试浏览一下代码，捕获一点关键信息。有：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">401106</span>: e8 <span class="token number">51</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        call   40145c <span class="token operator">&lt;</span>read_six_numbers<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>说明我们这里要读入6个数字，那么这个数字的特征尚不明确。我们先试着输入<code>1 3 5 7 9 11</code>，然后在<code>*0x40111b</code>处打断点。因为我们观察到，下面的代码似乎是在验证数字的合法性，否则炸弹就会爆炸。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040110b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">23</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">rsp</span>,<span class="token operator">%</span><span class="token register variable">r14</span>
<span class="token number">0x000000000040110e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">26</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">r12d</span>
<span class="token number">0x0000000000401114</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">32</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">r13</span>,<span class="token operator">%</span><span class="token register variable">rbp</span>
<span class="token number">0x0000000000401117</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">></span>:    mov    <span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">r13</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040111b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span>:    sub    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040111e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">42</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401121</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">45</span><span class="token operator">></span>:    jbe    <span class="token number">0x401128</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>
<span class="token number">0x0000000000401123</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">47</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们在每次运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401121</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">45</span><span class="token operator">></span>:    jbe    <span class="token number">0x401128</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看一下<code>%eax</code>的值，揣测一下有什么规律，这样就不必逐行分析代码了。代码会跳到后面的部分，我们等待运行回到上面的时候记录。接下来我将记录六次的<code>%eax</code>的值。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">0</span>

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$r12d</span>
<span class="token variable">$2</span> <span class="token operator">=</span> <span class="token number">2</span>

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$r12d</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">4</span>

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$r12d</span>
<span class="token variable">$4</span> <span class="token operator">=</span> <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行了四次炸弹就爆炸了。这意味着我们第四个值开始是有问题的。我们可以看到<code>%eax</code>实际上就是我们每次的<code>input - 1</code>，是否意味着<code>input - 1</code>一定要小于6？因为：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401117</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">></span>:    mov    <span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">r13</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040111b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">39</span><span class="token operator">></span>:    sub    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040111e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">42</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401121</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">45</span><span class="token operator">></span>:    jbe    <span class="token number">0x401128</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>
<span class="token number">0x0000000000401123</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">47</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里<code>%eax - 1</code>要小于等于<code>5</code>，否则就会爆炸，因此我们就知道<code>input - 1 &lt;= 5</code>，则我们输入一定要小于等于<code>6</code>！</p>
<p>我们试一下<code>1 2 3 4 5 6</code>，然后这一个炸弹一定是避开了，断点打在<code>*0x40113b</code>，每当运行到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">40113b: <span class="token number">39</span> <span class="token number">45</span> <span class="token number">00</span>              cmp    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token number">0x0</span>(<span class="token operator">%</span><span class="token register variable">rbp</span>)
40113e: <span class="token number">75</span> <span class="token number">05</span>                 jne    <span class="token number">401145</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">0x51</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我们就查看一次<code>%eax</code>和<code>%rbp</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/6 <span class="token variable">$rbp</span>
0x7fffffffd950: <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>
0x7fffffffd960: <span class="token number">5</span>       <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>$rbp</code>正好存放着我们输入的数字，我们在第二次循环再查看一下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$12</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/6 <span class="token variable">$rbp</span>
0x7fffffffd950: <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>
0x7fffffffd960: <span class="token number">5</span>       <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显而易见，<code>$eax</code>是<code>input + 1</code>。我们看看第六次循环：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$13</span> <span class="token operator">=</span> <span class="token number">3</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/6 <span class="token variable">$rbp</span>
0x7fffffffd954: <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>       <span class="token number">5</span>
0x7fffffffd964: <span class="token number">6</span>       <span class="token parameter variable">-134230016</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>好像超过我们预期的六个数字的界限了？我们看看第五次循环：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">6</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/6 <span class="token variable">$rbp</span>
0x7fffffffd950: <span class="token number">1</span>       <span class="token number">2</span>       <span class="token number">3</span>       <span class="token number">4</span>
0x7fffffffd960: <span class="token number">5</span>       <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>说明运行到第六次的时候，我们的<code>input</code>由于自增了，超出了<code>6</code>的界限，我们看看第六次跳转的时候这一行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401145</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">81</span><span class="token operator">></span>:    add    <span class="token operator">$</span><span class="token number">0x1</span>,<span class="token operator">%</span><span class="token register variable">ebx</span>
<span class="token number">0x0000000000401148</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">84</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x5</span>,<span class="token operator">%</span><span class="token register variable">ebx</span>
<span class="token number">0x000000000040114b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">87</span><span class="token operator">></span>:    jle    <span class="token number">0x401135</span> <span class="token operator">&lt;</span>phase_6<span class="token operator">+</span><span class="token number">65</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查看一下<code>%ebx</code>的值：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$ebx</span>
<span class="token variable">$2</span> <span class="token operator">=</span> <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这个时候刚好到了<code>6</code>，刚好会跳转了。写下来达到断点的次数（包括最开始的一次）为<code>5 4 3 2 1</code>。</p>
<p>我们看到奇怪的一行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401183</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">143</span><span class="token operator">></span>:   mov    <span class="token operator">$</span><span class="token number">0x6032d0</span>,<span class="token operator">%</span><span class="token register variable">edx</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里访问一下<code>0x6032d0</code>：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) x <span class="token number">0x6032d0</span>
<span class="token number">0x6032d0</span> <span class="token operator">&lt;</span>node1<span class="token operator">></span>:       <span class="token number">0x0000014c</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我们发现了一个节点？根据节点的特征，节点应该有值和下一个结点的内存地址，我们查看大一点的内容：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">(gdb) x<span class="token operator">/</span><span class="token number">100</span> <span class="token number">0x6032d0</span>
<span class="token number">0x6032d0</span> <span class="token operator">&lt;</span>node1<span class="token operator">></span>:       <span class="token number">0x0000014c</span>      <span class="token number">0x00000001</span>      <span class="token number">0x006032e0</span>      <span class="token number">0x00000000</span>
<span class="token number">0x6032e0</span> <span class="token operator">&lt;</span>node2<span class="token operator">></span>:       <span class="token number">0x000000a8</span>      <span class="token number">0x00000002</span>      <span class="token number">0x006032d0</span>      <span class="token number">0x00000000</span>
<span class="token number">0x6032f0</span> <span class="token operator">&lt;</span>node3<span class="token operator">></span>:       <span class="token number">0x0000039c</span>      <span class="token number">0x00000003</span>      <span class="token number">0x006032e0</span>      <span class="token number">0x00000000</span>
<span class="token number">0x603300</span> <span class="token operator">&lt;</span>node4<span class="token operator">></span>:       <span class="token number">0x000002b3</span>      <span class="token number">0x00000004</span>      <span class="token number">0x006032f0</span>      <span class="token number">0x00000000</span>
<span class="token number">0x603310</span> <span class="token operator">&lt;</span>node5<span class="token operator">></span>:       <span class="token number">0x000001dd</span>      <span class="token number">0x00000005</span>      <span class="token number">0x00603300</span>      <span class="token number">0x00000000</span>
<span class="token number">0x603320</span> <span class="token operator">&lt;</span>node6<span class="token operator">></span>:       <span class="token number">0x000001bb</span>      <span class="token number">0x00000006</span>      <span class="token number">0x00603310</span>      <span class="token number">0x00000000</span>
COMMENT <span class="token comment">; 以下省略</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到，第二个值是我们输入的内容，第三个值就是下一个结点的内存。我们可以写如下的代码：</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> ListNode <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> rootVal<span class="token punctuation">;</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">ListNode</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> ListNode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个结构有两个值和一个指针，其中这两个值一定有某种关系。最最最朴素的一种想法：会不会是<strong>排序</strong>呢？是从大到小还是从小到大呢？</p>
<p>那我们来尝试一下：从小到大应该输入的是<code>2 1 6 5 4 3</code>，从大到小是<code>3 4 5 6 1 2</code>。结果都不正确。</p>
<p>那会不会是排序的顺序进行了某种处理呢？我们已经限定了输入的数据必须小于等于<code>6</code>，按照排序的顺序应该输入的数值是<code>1 - 6</code>，那么加密后的数据也是<code>1 - 6</code>。这怎么做到的呢？比如加上一个数字模<code>7</code>？或者被<code>7</code>减去？那么我们肯定要找找汇编代码有没有数字<code>7</code>了，通过搜索果然发现：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">40115b: b9 <span class="token number">07</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x7</span>,<span class="token operator">%</span><span class="token register variable">ecx</span>
<span class="token number">401160</span>: <span class="token number">89</span> ca                 mov    <span class="token operator">%</span><span class="token register variable">ecx</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">401162</span>: 2b <span class="token number">10</span>                 sub    (<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">edx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这个代码比较简单，我们只要查看一下运行到这里的时候<code>%rax</code>是谁就可以了，相信这个寄存器一定与我们的输入有关。我们在<code>*0x401162</code>打一个断点，还是输入<code>1 2 3 4 5 6</code>，每次经过的时候记录一下值。结果如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd950: 0x00000001

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd954: 0x00000002

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd958: 0x00000003

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd95c: 0x00000004

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd960: 0x00000005

<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x <span class="token variable">$rax</span>
0x7fffffffd964: 0x00000006<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>说明<code>($rax)</code>就是我们的输入。由上面的代码分析，我们知道最终<code>%edx</code>的值是<code>7 - input</code>。我们处理一下我们刚刚的猜测：从小到大应该输入的是<code>5 6 1 2 3 4</code>，从大到小是<code>4 3 2 1 6 5</code>。最终答案就是：</p>
<p><strong><code>4 3 2 1 6 5</code></strong></p>
<h3 id="运行截图-5"><a href="#运行截图-5" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/14/QsUo7mROE1VBiKY.png" alt="phase_6.png"></p>
<hr>
<h2 id="Secret-Phase"><a href="#Secret-Phase" class="headerlink" title="Secret Phase"></a>Secret Phase</h2><h3 id="汇编代码-6"><a href="#汇编代码-6" class="headerlink" title="汇编代码"></a>汇编代码</h3><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0000000000401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>:
  <span class="token number">401204</span>: <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">08</span>           sub    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401208</span>: <span class="token number">48</span> <span class="token number">85</span> ff              test   <span class="token operator">%</span><span class="token register variable">rdi</span>,<span class="token operator">%</span><span class="token register variable">rdi</span>
  40120b: <span class="token number">74</span> 2b                 je     <span class="token number">401238</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">0x34</span><span class="token operator">></span>
  <span class="token number">40120d</span>: 8b <span class="token number">17</span>                 mov    (<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
  40120f: <span class="token number">39</span> f2                 cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401211</span>: 7e <span class="token number">0d</span>                 jle    <span class="token number">401220</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">0x1c</span><span class="token operator">></span>
  <span class="token number">401213</span>: <span class="token number">48</span> 8b 7f <span class="token number">08</span>           mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
  <span class="token number">401217</span>: e8 e8 ff ff ff        call   <span class="token number">401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
  40121c: <span class="token number">01</span> c0                 add    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40121e: eb <span class="token number">1d</span>                 jmp    <span class="token number">40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">0x39</span><span class="token operator">></span>
  <span class="token number">401220</span>: b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401225</span>: <span class="token number">39</span> f2                 cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">401227</span>: <span class="token number">74</span> <span class="token number">14</span>                 je     <span class="token number">40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">0x39</span><span class="token operator">></span>
  <span class="token number">401229</span>: <span class="token number">48</span> 8b 7f <span class="token number">10</span>           mov    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
  <span class="token number">40122d</span>: e8 d2 ff ff ff        call   <span class="token number">401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
  <span class="token number">401232</span>: <span class="token number">8d</span> <span class="token number">44</span> <span class="token number">00</span> <span class="token number">01</span>           lea    <span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401236</span>: eb <span class="token number">05</span>                 jmp    <span class="token number">40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">0x39</span><span class="token operator">></span>
  <span class="token number">401238</span>: b8 ff ff ff ff        mov    <span class="token operator">$</span><span class="token number">0xffffffff</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">40123d</span>: <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">08</span>           add    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401241</span>: c3                    ret

<span class="token number">0000000000401242</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">></span>:
  <span class="token number">401242</span>: <span class="token number">53</span>                    push   <span class="token operator">%</span><span class="token register variable">rbx</span>
  <span class="token number">401243</span>: e8 <span class="token number">56</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>        call   40149e <span class="token operator">&lt;</span>read_line<span class="token operator">></span>
  <span class="token number">401248</span>: ba 0a <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0xa</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
  <span class="token number">40124d</span>: be <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  <span class="token number">401252</span>: <span class="token number">48</span> <span class="token number">89</span> c7              mov    <span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rdi</span>
  <span class="token number">401255</span>: e8 <span class="token number">76</span> f9 ff ff        call   400bd0 <span class="token operator">&lt;</span>strtol@plt<span class="token operator">></span>
  40125a: <span class="token number">48</span> <span class="token number">89</span> c3              mov    <span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rbx</span>
  <span class="token number">40125d</span>: <span class="token number">8d</span> <span class="token number">40</span> ff              lea    <span class="token operator">-</span><span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401260</span>: <span class="token number">3d</span> e8 <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        cmp    <span class="token operator">$</span><span class="token number">0x3e8</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401265</span>: <span class="token number">76</span> <span class="token number">05</span>                 jbe    40126c <span class="token operator">&lt;</span>secret_phase<span class="token operator">+</span><span class="token number">0x2a</span><span class="token operator">></span>
  <span class="token number">401267</span>: e8 ce <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  40126c: <span class="token number">89</span> de                 mov    <span class="token operator">%</span><span class="token register variable">ebx</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  40126e: bf f0 <span class="token number">30</span> <span class="token number">60</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x6030f0</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  <span class="token number">401273</span>: e8 8c ff ff ff        call   <span class="token number">401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
  <span class="token number">401278</span>: <span class="token number">83</span> f8 <span class="token number">02</span>              cmp    <span class="token operator">$</span><span class="token number">0x2</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  40127b: <span class="token number">74</span> <span class="token number">05</span>                 je     <span class="token number">401282</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">+</span><span class="token number">0x40</span><span class="token operator">></span>
  <span class="token number">40127d</span>: e8 b8 <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span>        call   40143a <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span>
  <span class="token number">401282</span>: bf <span class="token number">38</span> <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x402438</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  <span class="token number">401287</span>: e8 <span class="token number">84</span> f8 ff ff        call   400b10 <span class="token operator">&lt;</span>puts@plt<span class="token operator">></span>
  40128c: e8 <span class="token number">33</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">00</span>        call   4015c4 <span class="token operator">&lt;</span>phase_defused<span class="token operator">></span>
  <span class="token number">401291</span>: 5b                    pop    <span class="token operator">%</span><span class="token register variable">rbx</span>
  <span class="token number">401292</span>: c3                    ret
  <span class="token number">401293</span>: <span class="token number">90</span>                    nop
  <span class="token number">401294</span>: <span class="token number">90</span>                    nop
  <span class="token number">401295</span>: <span class="token number">90</span>                    nop
  <span class="token number">401296</span>: <span class="token number">90</span>                    nop
  <span class="token number">401297</span>: <span class="token number">90</span>                    nop
  <span class="token number">401298</span>: <span class="token number">90</span>                    nop
  <span class="token number">401299</span>: <span class="token number">90</span>                    nop
  40129a: <span class="token number">90</span>                    nop
  40129b: <span class="token number">90</span>                    nop
  40129c: <span class="token number">90</span>                    nop
  <span class="token number">40129d</span>: <span class="token number">90</span>                    nop
  40129e: <span class="token number">90</span>                    nop
  40129f: <span class="token number">90</span>                    nop

00000000004015c4 <span class="token operator">&lt;</span>phase_defused<span class="token operator">></span>:
  4015c4: <span class="token number">48</span> <span class="token number">83</span> ec <span class="token number">78</span>           sub    <span class="token operator">$</span><span class="token number">0x78</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  4015c8: <span class="token number">64</span> <span class="token number">48</span> 8b <span class="token number">04</span> <span class="token number">25</span> <span class="token number">28</span> <span class="token number">00</span>  mov    <span class="token operator">%</span><span class="token register variable">fs</span>:<span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  4015cf: <span class="token number">00</span> <span class="token number">00</span> 
  4015d1: <span class="token number">48</span> <span class="token number">89</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">68</span>        mov    <span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">0x68</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>)
  4015d6: <span class="token number">31</span> c0                 xor    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  4015d8: <span class="token number">83</span> <span class="token number">3d</span> <span class="token number">81</span> <span class="token number">21</span> <span class="token number">20</span> <span class="token number">00</span> <span class="token number">06</span>  cmpl   <span class="token operator">$</span><span class="token number">0x6</span>,<span class="token number">0x202181</span>(<span class="token operator">%</span>rip)        # <span class="token number">603760</span> <span class="token operator">&lt;</span>num_input_strings<span class="token operator">></span>
  4015df: <span class="token number">75</span> 5e                 jne    40163f <span class="token operator">&lt;</span>phase_defused<span class="token operator">+</span><span class="token number">0x7b</span><span class="token operator">></span>
  <span class="token number">4015e1</span>: 4c <span class="token number">8d</span> <span class="token number">44</span> <span class="token number">24</span> <span class="token number">10</span>        lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">r8</span>
  <span class="token number">4015e6</span>: <span class="token number">48</span> <span class="token number">8d</span> 4c <span class="token number">24</span> 0c        lea    <span class="token number">0xc</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rcx</span>
  4015eb: <span class="token number">48</span> <span class="token number">8d</span> <span class="token number">54</span> <span class="token number">24</span> <span class="token number">08</span>        lea    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdx</span>
  4015f0: be <span class="token number">19</span> <span class="token number">26</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x402619</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  4015f5: bf <span class="token number">70</span> <span class="token number">38</span> <span class="token number">60</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x603870</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  4015fa: e8 f1 f5 ff ff        call   400bf0 <span class="token operator">&lt;</span>__isoc99_sscanf@plt<span class="token operator">></span>
  4015ff: <span class="token number">83</span> f8 <span class="token number">03</span>              cmp    <span class="token operator">$</span><span class="token number">0x3</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401602</span>: <span class="token number">75</span> <span class="token number">31</span>                 jne    <span class="token number">401635</span> <span class="token operator">&lt;</span>phase_defused<span class="token operator">+</span><span class="token number">0x71</span><span class="token operator">></span>
  <span class="token number">401604</span>: be <span class="token number">22</span> <span class="token number">26</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x402622</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
  <span class="token number">401609</span>: <span class="token number">48</span> <span class="token number">8d</span> 7c <span class="token number">24</span> <span class="token number">10</span>        lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
  40160e: e8 <span class="token number">25</span> fd ff ff        call   <span class="token number">401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
  <span class="token number">401613</span>: <span class="token number">85</span> c0                 test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401615</span>: <span class="token number">75</span> 1e                 jne    <span class="token number">401635</span> <span class="token operator">&lt;</span>phase_defused<span class="token operator">+</span><span class="token number">0x71</span><span class="token operator">></span>
  <span class="token number">401617</span>: bf f8 <span class="token number">24</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x4024f8</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  40161c: e8 ef f4 ff ff        call   400b10 <span class="token operator">&lt;</span>puts@plt<span class="token operator">></span>
  <span class="token number">401621</span>: bf <span class="token number">20</span> <span class="token number">25</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x402520</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  <span class="token number">401626</span>: e8 e5 f4 ff ff        call   400b10 <span class="token operator">&lt;</span>puts@plt<span class="token operator">></span>
  40162b: b8 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
  <span class="token number">401630</span>: e8 <span class="token number">0d</span> fc ff ff        call   <span class="token number">401242</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">></span>
  <span class="token number">401635</span>: bf <span class="token number">58</span> <span class="token number">25</span> <span class="token number">40</span> <span class="token number">00</span>        mov    <span class="token operator">$</span><span class="token number">0x402558</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
  40163a: e8 d1 f4 ff ff        call   400b10 <span class="token operator">&lt;</span>puts@plt<span class="token operator">></span>
  40163f: <span class="token number">48</span> 8b <span class="token number">44</span> <span class="token number">24</span> <span class="token number">68</span>        mov    <span class="token number">0x68</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rax</span>
  <span class="token number">401644</span>: <span class="token number">64</span> <span class="token number">48</span> <span class="token number">33</span> <span class="token number">04</span> <span class="token number">25</span> <span class="token number">28</span> <span class="token number">00</span>  xor    <span class="token operator">%</span><span class="token register variable">fs</span>:<span class="token number">0x28</span>,<span class="token operator">%</span><span class="token register variable">rax</span>
  40164b: <span class="token number">00</span> <span class="token number">00</span> 
  <span class="token number">40164d</span>: <span class="token number">74</span> <span class="token number">05</span>                 je     <span class="token number">401654</span> <span class="token operator">&lt;</span>phase_defused<span class="token operator">+</span><span class="token number">0x90</span><span class="token operator">></span>
  40164f: e8 dc f4 ff ff        call   400b30 <span class="token operator">&lt;</span>__stack_chk_fail@plt<span class="token operator">></span>
  <span class="token number">401654</span>: <span class="token number">48</span> <span class="token number">83</span> c4 <span class="token number">78</span>           add    <span class="token operator">$</span><span class="token number">0x78</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
  <span class="token number">401658</span>: c3                    ret
  <span class="token number">401659</span>: <span class="token number">90</span>                    nop
  40165a: <span class="token number">90</span>                    nop
  40165b: <span class="token number">90</span>                    nop
  40165c: <span class="token number">90</span>                    nop
  <span class="token number">40165d</span>: <span class="token number">90</span>                    nop
  40165e: <span class="token number">90</span>                    nop
  40165f: <span class="token number">90</span>                    nop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-6"><a href="#分析过程-6" class="headerlink" title="分析过程"></a>分析过程</h3><p>我们想要找到<code>secret_phase</code>什么时候被调用。通过搜索得到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">00000000004015c4 <span class="token operator">&lt;</span>phase_defused<span class="token operator">></span>:
  COMMENT <span class="token comment">; ...</span>
  <span class="token number">401630</span>: e8 <span class="token number">0d</span> fc ff ff        call   <span class="token number">401242</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">></span>
  COMMENT <span class="token comment">; ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>phase_defused</code>中找到了我们函数的入口。我们看到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm">4015fa: e8 f1 f5 ff ff        call   400bf0 <span class="token operator">&lt;</span>__isoc99_sscanf@plt<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>因此可以尝试看看<code>__isoc99_sscanf@plt</code>里面需要我们输入什么。我们给<code>phase_defused</code>和<code>*0x4015fa</code>各打一个断点，以便我们查看其内容。发现在第六个炸弹拆除后调用<code>phase_defused</code>时，出现了如下一行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">__GI___isoc99_sscanf <span class="token punctuation">(</span>s<span class="token operator">=</span>0x603870 <span class="token operator">&lt;</span>input_strings+24<span class="token operator"><span class="token file-descriptor important">0</span>></span> <span class="token string">"0 0"</span>, <span class="token assign-left variable">format</span><span class="token operator">=</span>0x402619 <span class="token string">"%d %d %s"</span><span class="token punctuation">)</span> at ./stdio-common/isoc99_sscanf.c:24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里的<code>0 0</code>显然是我们在<code>phase_4</code>时输入的答案，此时这个函数允许我们输入两个整型和一个字符串，或许我们只要找到这个字符串就能找到入口了？观察到这一行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401604</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x402622</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
<span class="token number">0x0000000000401609</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">69</span><span class="token operator">></span>:    lea    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rsp</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x000000000040160e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">74</span><span class="token operator">></span>:    call   <span class="token number">0x401338</span> <span class="token operator">&lt;</span>strings_not_equal<span class="token operator">></span>
<span class="token number">0x0000000000401613</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">79</span><span class="token operator">></span>:    test   <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401615</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">81</span><span class="token operator">></span>:    jne    <span class="token number">0x401635</span> <span class="token operator">&lt;</span>phase_defused<span class="token operator">+</span><span class="token number">113</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们不由地想到<code>strings_not_equal</code>函数的用法，如果我们在第三个参数输入了正确的字符串，就不会跳转到<code>0x0000000000401635 &lt;+113&gt;</code>，而是会进入<code>0x0000000000401630 &lt;+108&gt;</code>，进入隐藏炸弹。</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401630</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">108</span><span class="token operator">></span>:   call   <span class="token number">0x401242</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">></span>
<span class="token number">0x0000000000401635</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">113</span><span class="token operator">></span>:   mov    <span class="token operator">$</span><span class="token number">0x402558</span>,<span class="token operator">%</span><span class="token register variable">edi</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我们尝试获取<code>0x402622</code>所表示的字符串：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x /s 0x402622
0x402622:       <span class="token string">"DrEvil"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这时候我们修改一下我们的<code>ans.txt</code>，在第四个炸弹答案中加上<code>DrEvil</code>。果然显示了如下句子：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Curses, you've found the secret phase<span class="token operator">!</span>
But finding it and solving it are quite different<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>这样就进入了隐藏炸弹。来观察一下我们的<code>secret_phase</code>。先解决一下输入格式：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">401243</span>: e8 <span class="token number">56</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span>        call   40149e <span class="token operator">&lt;</span>read_line<span class="token operator">></span>
COMMENT <span class="token comment">; ...</span>
<span class="token number">401255</span>: e8 <span class="token number">76</span> f9 ff ff        call   400bd0 <span class="token operator">&lt;</span>strtol@plt<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>说明程序读入一个字符串并且转成<code>long int</code>。我们可以推测答案实际上就是一个整数。观察到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040125a</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rbx</span>
<span class="token number">0x000000000040125d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">27</span><span class="token operator">></span>:    lea    <span class="token operator">-</span><span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rax</span>),<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401260</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">30</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x3e8</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401265</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">></span>:    jbe    <span class="token number">0x40126c</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">+</span><span class="token number">42</span><span class="token operator">></span>
<span class="token number">0x0000000000401267</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">37</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们要判断一下<code>%rax</code>一开始的值，在<code>*0x40125a</code>打断点，并且输入<code>23</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$rbx</span>
<span class="token variable">$1</span> <span class="token operator">=</span> <span class="token number">23</span>
<span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$2</span> <span class="token operator">=</span> <span class="token number">22</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>说明一开始<code>%rax</code>就存放我们输入的数字，然后自减一次，结果一定要小于等于<code>0x3e8</code>，说明我们输入的数一定要小于等于<code>1001</code>。再往下看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040126c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">42</span><span class="token operator">></span>:    mov    <span class="token operator">%</span><span class="token register variable">ebx</span>,<span class="token operator">%</span><span class="token register variable">esi</span>
<span class="token number">0x000000000040126e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">44</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x6030f0</span>,<span class="token operator">%</span><span class="token register variable">edi</span>
<span class="token number">0x0000000000401273</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">49</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
<span class="token number">0x0000000000401278</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">54</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x2</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040127b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>:    je     <span class="token number">0x401282</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span>
<span class="token number">0x000000000040127d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">59</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们知道<code>%ebx == %rbx == 23</code>，就是我们输入的数值。查看一下<code>*0x6030f0</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p *0x6030f0
<span class="token variable">$7</span> <span class="token operator">=</span> <span class="token number">36</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>看不出什么规律。那我们接着往下，等调用完<code>func7</code>后看看<code>%eax</code>的值：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$eax</span>
<span class="token variable">$8</span> <span class="token operator">=</span> <span class="token parameter variable">-10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>要让<code>%eax</code>等于<code>2</code>才不会爆炸。我们因此需要分析一下<code>func7</code>了。在<code>fun7</code>打断点，忽略栈空间分配，我们看到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401208</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span>:     test   <span class="token operator">%</span><span class="token register variable">rdi</span>,<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x000000000040120b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">7</span><span class="token operator">></span>:     je     <span class="token number">0x401238</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>
<span class="token number">0x000000000040120d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">9</span><span class="token operator">></span>:     mov    (<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
COMMENT <span class="token comment">; ...</span>
<span class="token number">0x0000000000401238</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0xffffffff</span>,<span class="token operator">%</span><span class="token register variable">eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里查看一下<code>%rdi</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p *<span class="token variable">$rdi</span>
<span class="token variable">$2</span> <span class="token operator">=</span> <span class="token number">36</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>刚好是我们上面那个不明所以的数字。如果<code>%rdi</code>为<code>0</code>，注意到<code>0x401238</code>，就会给返回值<code>%eax</code>赋值为<code>-1</code>。为什么有<code>-1</code>呢？大概率是这个函数不符合某个条件的时候会返回这个值。那么当<code>%rdi</code>为<code>0</code>就满足了这个条件。在看这个函数，我们可以发现其两次调用了自己本身，因此这是一个递归函数。我们观察一下什么时候会发生递归：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401213</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">15</span><span class="token operator">></span>:    mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x0000000000401217</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">19</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
COMMENT <span class="token comment">; ...</span>
<span class="token number">0x0000000000401229</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">37</span><span class="token operator">></span>:    mov    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>
<span class="token number">0x000000000040122d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看出，每次递归都多开辟了<code>8</code>个内存空间，这也许是两个变量的意思。再往前看：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x000000000040120d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">9</span><span class="token operator">></span>:     mov    (<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">0x000000000040120f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">11</span><span class="token operator">></span>:    cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">0x0000000000401211</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">13</span><span class="token operator">></span>:    jle    <span class="token number">0x401220</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><code>(%rdi)</code>就是之前不明所以的值。我们查看一下<code>%esi</code>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> p <span class="token variable">$esi</span>
<span class="token variable">$3</span> <span class="token operator">=</span> <span class="token number">23</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>我们现在是在比较输入的值和这个不明所以的值！如果输入的值大于这个数，就会跳转到：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401220</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x0000000000401225</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">33</span><span class="token operator">></span>:    cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>
<span class="token number">0x0000000000401227</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">></span>:    je     <span class="token number">0x40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>满足条件就跳出当前递归了。这个不明所以的值确实很恼人，我们还记得它的地址是<code>0x6030f0</code>，我们可能需要用别的方法看看它是什么。我们不妨一次性看多一点：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x/100 0x6030f0
0x6030f0 <span class="token operator">&lt;</span>n<span class="token operator"><span class="token file-descriptor important">1</span>></span>:  0x00000024      0x00000000      0x00603110      0x00000000
0x603100 <span class="token operator">&lt;</span>n1+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:       0x00603130      0x00000000      0x00000000      0x00000000
0x603110 <span class="token operator">&lt;</span>n2<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000008      0x00000000      0x00603190      0x00000000
0x603120 <span class="token operator">&lt;</span>n21+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603150      0x00000000      0x00000000      0x00000000
0x603130 <span class="token operator">&lt;</span>n2<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000032      0x00000000      0x00603170      0x00000000
0x603140 <span class="token operator">&lt;</span>n22+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x006031b0      0x00000000      0x00000000      0x00000000
0x603150 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000016      0x00000000      0x00603270      0x00000000
0x603160 <span class="token operator">&lt;</span>n32+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603230      0x00000000      0x00000000      0x00000000
0x603170 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">3</span>></span>: 0x0000002d      0x00000000      0x006031d0      0x00000000
0x603180 <span class="token operator">&lt;</span>n33+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603290      0x00000000      0x00000000      0x00000000
0x603190 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000006      0x00000000      0x006031f0      0x00000000
0x6031a0 <span class="token operator">&lt;</span>n31+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603250      0x00000000      0x00000000      0x00000000
0x6031b0 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">4</span>></span>: 0x0000006b      0x00000000      0x00603210      0x00000000
0x6031c0 <span class="token operator">&lt;</span>n34+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x006032b0      0x00000000      0x00000000      0x00000000
0x6031d0 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">5</span>></span>: 0x00000028      0x00000000      0x00000000      0x00000000
0x6031e0 <span class="token operator">&lt;</span>n45+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x6031f0 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000001      0x00000000      0x00000000      0x00000000
0x603200 <span class="token operator">&lt;</span>n41+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603210 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">7</span>></span>: 0x00000063      0x00000000      0x00000000      0x00000000
0x603220 <span class="token operator">&lt;</span>n47+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603230 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">4</span>></span>: 0x00000023      0x00000000      0x00000000      0x00000000
0x603240 <span class="token operator">&lt;</span>n44+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603250 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000007      0x00000000      0x00000000      0x00000000
0x603260 <span class="token operator">&lt;</span>n42+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603270 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">3</span>></span>: 0x00000014      0x00000000      0x00000000      0x00000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这看上去像是某种像链表的数据结构。但如果是链表，应该只会占据<code>16</code>个字节，而这里占据了<code>24</code>个字节。会不会可能是二叉树呢？我们来看看以下结构：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">TreeNode</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> val<span class="token punctuation">;</span>
    TreeNode <span class="token operator">*</span>left<span class="token punctuation">;</span>
    TreeNode <span class="token operator">*</span>right<span class="token punctuation">;</span>

    <span class="token function">TreeNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> val<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">val</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>因此增加<code>8</code>个内存单位就是为了存放一个节点指针。我们可以延续这个假设，然后来逐行分析汇编代码：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401204</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">0</span><span class="token operator">></span>:     sub    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>            
<span class="token number">0x0000000000401208</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">4</span><span class="token operator">></span>:     test   <span class="token operator">%</span><span class="token register variable">rdi</span>,<span class="token operator">%</span><span class="token register variable">rdi</span>             # 检查是否是NULL，因为NULL <span class="token operator">=</span><span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">0x000000000040120b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">7</span><span class="token operator">></span>:     je     <span class="token number">0x401238</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>    # 如果是NULL，跳到<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>，返回<span class="token operator">-</span><span class="token number">1</span>
<span class="token number">0x000000000040120d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">9</span><span class="token operator">></span>:     mov    (<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">edx</span>           
<span class="token number">0x000000000040120f</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">11</span><span class="token operator">></span>:    cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>             # 比较target和当前节点val
<span class="token number">0x0000000000401211</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">13</span><span class="token operator">></span>:    jle    <span class="token number">0x401220</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span>    # 如果target <span class="token operator">></span><span class="token operator">=</span> node<span class="token operator">-</span><span class="token operator">></span>val，跳转到<span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span>
<span class="token number">0x0000000000401213</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">15</span><span class="token operator">></span>:    mov    <span class="token number">0x8</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>        
<span class="token number">0x0000000000401217</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">19</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>       # 否则传入node<span class="token operator">-</span><span class="token operator">></span>left
<span class="token number">0x000000000040121c</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">24</span><span class="token operator">></span>:    add    <span class="token operator">%</span><span class="token register variable">eax</span>,<span class="token operator">%</span><span class="token register variable">eax</span>             # node<span class="token operator">-</span><span class="token operator">></span>val <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2</span>
<span class="token number">0x000000000040121e</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">26</span><span class="token operator">></span>:    jmp    <span class="token number">0x40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>    # 结束递归
<span class="token number">0x0000000000401220</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">28</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0x0</span>,<span class="token operator">%</span><span class="token register variable">eax</span>             # 赋值为<span class="token number">0</span>
<span class="token number">0x0000000000401225</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">33</span><span class="token operator">></span>:    cmp    <span class="token operator">%</span><span class="token register variable">esi</span>,<span class="token operator">%</span><span class="token register variable">edx</span>             # 比较当前节点和target
<span class="token number">0x0000000000401227</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">35</span><span class="token operator">></span>:    je     <span class="token number">0x40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>    # 如果相等就返回，返回值就是上面设置的<span class="token operator">%</span><span class="token register variable">eax</span>，为<span class="token number">0</span>
<span class="token number">0x0000000000401229</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">37</span><span class="token operator">></span>:    mov    <span class="token number">0x10</span>(<span class="token operator">%</span><span class="token register variable">rdi</span>),<span class="token operator">%</span><span class="token register variable">rdi</span>       
<span class="token number">0x000000000040122d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">41</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>       # 传入node<span class="token operator">-</span><span class="token operator">></span>right
<span class="token number">0x0000000000401232</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">46</span><span class="token operator">></span>:    lea    <span class="token number">0x1</span>(<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token operator">%</span><span class="token register variable">rax</span>,<span class="token number">1</span>),<span class="token operator">%</span><span class="token register variable">eax</span> # node<span class="token operator">-</span><span class="token operator">></span>val <span class="token operator">=</span> node<span class="token operator">-</span><span class="token operator">></span>val <span class="token operator">+</span> <span class="token number">1</span>
<span class="token number">0x0000000000401236</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">50</span><span class="token operator">></span>:    jmp    <span class="token number">0x40123d</span> <span class="token operator">&lt;</span>fun7<span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>    # 返回
<span class="token number">0x0000000000401238</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">52</span><span class="token operator">></span>:    mov    <span class="token operator">$</span><span class="token number">0xffffffff</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040123d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>:    add    <span class="token operator">$</span><span class="token number">0x8</span>,<span class="token operator">%</span><span class="token register variable">rsp</span>
<span class="token number">0x0000000000401241</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">61</span><span class="token operator">></span>:    ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以写出伪代码：</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">func7</span><span class="token punctuation">(</span><span class="token keyword">int</span> target<span class="token punctuation">,</span> TreeNode <span class="token operator">*</span>node<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">==</span> node<span class="token operator">-></span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">></span> node<span class="token operator">-></span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">func7</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> node<span class="token operator">-></span>right<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token function">func7</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> node<span class="token operator">-></span>left<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>我们再生成一次二叉树的结构：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>gdb<span class="token punctuation">)</span> x /200 0x6030f0
0x6030f0 <span class="token operator">&lt;</span>n<span class="token operator"><span class="token file-descriptor important">1</span>></span>:  0x00000024      0x00000000      0x00603110      0x00000000
0x603100 <span class="token operator">&lt;</span>n1+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:       0x00603130      0x00000000      0x00000000      0x00000000
0x603110 <span class="token operator">&lt;</span>n2<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000008      0x00000000      0x00603190      0x00000000
0x603120 <span class="token operator">&lt;</span>n21+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603150      0x00000000      0x00000000      0x00000000
0x603130 <span class="token operator">&lt;</span>n2<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000032      0x00000000      0x00603170      0x00000000
0x603140 <span class="token operator">&lt;</span>n22+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x006031b0      0x00000000      0x00000000      0x00000000
0x603150 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000016      0x00000000      0x00603270      0x00000000
0x603160 <span class="token operator">&lt;</span>n32+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603230      0x00000000      0x00000000      0x00000000
0x603170 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">3</span>></span>: 0x0000002d      0x00000000      0x006031d0      0x00000000
0x603180 <span class="token operator">&lt;</span>n33+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603290      0x00000000      0x00000000      0x00000000
0x603190 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000006      0x00000000      0x006031f0      0x00000000
0x6031a0 <span class="token operator">&lt;</span>n31+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00603250      0x00000000      0x00000000      0x00000000
0x6031b0 <span class="token operator">&lt;</span>n3<span class="token operator"><span class="token file-descriptor important">4</span>></span>: 0x0000006b      0x00000000      0x00603210      0x00000000
0x6031c0 <span class="token operator">&lt;</span>n34+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x006032b0      0x00000000      0x00000000      0x00000000
0x6031d0 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">5</span>></span>: 0x00000028      0x00000000      0x00000000      0x00000000
0x6031e0 <span class="token operator">&lt;</span>n45+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x6031f0 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">1</span>></span>: 0x00000001      0x00000000      0x00000000      0x00000000
0x603200 <span class="token operator">&lt;</span>n41+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603210 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">7</span>></span>: 0x00000063      0x00000000      0x00000000      0x00000000
0x603220 <span class="token operator">&lt;</span>n47+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603230 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">4</span>></span>: 0x00000023      0x00000000      0x00000000      0x00000000
0x603240 <span class="token operator">&lt;</span>n44+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603250 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">2</span>></span>: 0x00000007      0x00000000      0x00000000      0x00000000
0x603260 <span class="token operator">&lt;</span>n42+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603270 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">3</span>></span>: 0x00000014      0x00000000      0x00000000      0x00000000
0x603280 <span class="token operator">&lt;</span>n43+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x603290 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">6</span>></span>: 0x0000002f      0x00000000      0x00000000      0x00000000
0x6032a0 <span class="token operator">&lt;</span>n46+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x6032b0 <span class="token operator">&lt;</span>n4<span class="token operator"><span class="token file-descriptor important">8</span>></span>: 0x000003e9      0x00000000      0x00000000      0x00000000
0x6032c0 <span class="token operator">&lt;</span>n48+1<span class="token operator"><span class="token file-descriptor important">6</span>></span>:      0x00000000      0x00000000      0x00000000      0x00000000
0x6032d0 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">1</span>></span>:       0x0000014c      0x00000001      0x006032e0      0x00000000
0x6032e0 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">2</span>></span>:       0x000000a8      0x00000002      0x00000000      0x00000000
0x6032f0 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">3</span>></span>:       0x0000039c      0x00000003      0x00603300      0x00000000
0x603300 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">4</span>></span>:       0x000002b3      0x00000004      0x00603310      0x00000000
0x603310 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">5</span>></span>:       0x000001dd      0x00000005      0x00603320      0x00000000
0x603320 <span class="token operator">&lt;</span>node<span class="token operator"><span class="token file-descriptor important">6</span>></span>:       0x000001bb      0x00000006      0x006032d0      0x00000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>根据上面的代码，我们知道这是一个<strong>二叉搜索树</strong>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">         <span class="token number">36</span>
      /       <span class="token punctuation">\</span>
     <span class="token number">8</span>         <span class="token number">50</span>
   /   <span class="token punctuation">\</span>      /   <span class="token punctuation">\</span>
  <span class="token number">6</span>    <span class="token number">22</span>    <span class="token number">45</span>   <span class="token number">107</span>
 / <span class="token punctuation">\</span>   / <span class="token punctuation">\</span>   / <span class="token punctuation">\</span>   / <span class="token punctuation">\</span>
<span class="token number">1</span>   <span class="token number">7</span> <span class="token number">20</span> <span class="token number">35</span> <span class="token number">40</span> <span class="token number">47</span> <span class="token number">99</span> <span class="token number">1001</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一直不理解的<code>36</code>实际上就是头节点的值而已。那我们需要函数返回什么呢？看到<code>secret_phase</code>中这几行：</p>
<pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token number">0x0000000000401273</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">49</span><span class="token operator">></span>:    call   <span class="token number">0x401204</span> <span class="token operator">&lt;</span>fun7<span class="token operator">></span>
<span class="token number">0x0000000000401278</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">54</span><span class="token operator">></span>:    cmp    <span class="token operator">$</span><span class="token number">0x2</span>,<span class="token operator">%</span><span class="token register variable">eax</span>
<span class="token number">0x000000000040127b</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">57</span><span class="token operator">></span>:    je     <span class="token number">0x401282</span> <span class="token operator">&lt;</span>secret_phase<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span>
<span class="token number">0x000000000040127d</span> <span class="token operator">&lt;</span><span class="token operator">+</span><span class="token number">59</span><span class="token operator">></span>:    call   <span class="token number">0x40143a</span> <span class="token operator">&lt;</span>explode_bomb<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中<code>%eax</code>是<code>func7</code>的返回值。我们需要返回值是<code>2</code>才能拆除炸弹。什么时候返回的才能是<code>2</code>呢？比如说一个函数返回了<code>0</code>，然后这个<code>0</code>是右子树来的，所以<code>0 * 2 + 1</code>得到<code>1</code>；当然也可以是从很多个左子树来的，毕竟<code>0 * 2</code>还是<code>0</code>。接着这个<code>1</code>是从左子树来的，因此<code>1 * 2</code>得到了<code>2</code>。反过来思考，我们就是先从根节点往左找，再往右找，就可以找到了，答案是<code>22</code>。也可以再从<code>22</code>的左子树一直找，这样就还能找到一个答案<code>20</code>。</p>
<p>最终答案是：</p>
<p><strong><code>20</code> 或 <code>22</code></strong></p>
<h3 id="运行截图-6"><a href="#运行截图-6" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://s2.loli.net/2025/04/14/KS3LzR2BT9nGMhv.png" alt="secret_phase_0.png"></p>
<p><img src="https://s2.loli.net/2025/04/14/sB6ODkRyfUSt5HN.png" alt="secret_phase_1.png"></p>
<hr>

  </div>
</mdui-card>
<script>
  const $ = mdui.$;
  $("#post-all").find("img").each((index, ele) => {
    $(ele).replaceWith(`<a data-src="${$(ele).prop("src")}" class="fancybox-enabled" data-fancybox="picture" data-caption="${$(ele).prop("alt")}">${ele.outerHTML}</a>`)
  });
  Fancybox.bind(".fancybox-enabled", {
    on: {
      ready: () => {
        $("mdui-top-app-bar").addClass("invisible")
      }, close: () => {
        $("mdui-top-app-bar").removeClass("invisible")
      }
    }
  });
  
</script>

    
                    
              <br>
              <span>© 2025 Eagle233 <br>Powered By Hexo & Theme mdsuper</span>
          </div>
        </mdui-layout-main>
    </mdui-layout>
    <script>const searchxml_url = "/search.xml";</script>

<script src="/js/mdsuper-search.js"></script>

    <mdui-dialog close-on-overlay-click close-on-esc fullscreen id="search-dlg">
        <mdui-top-app-bar slot="header" style="padding: 32px;">
            <mdui-top-app-bar-title>
                Search
            </mdui-top-app-bar-title>
            <mdui-button-icon icon="close" id="search-dlg-close"></mdui-button-icon>
        </mdui-top-app-bar>
        <mdui-text-field icon="search" label='Search' id="search-input"></mdui-text-field>
        <mdui-list id="search-res-list">
        </mdui-list>
    </mdui-dialog>
    <script>
        $("#search-dlg-close").on("click", function () {
            $("#search-dlg").get(0).open = false;
        });
        $("#search-input").get(0).addEventListener('input', function () {
            let val = $(this).val().toLowerCase();
            $("#search-res-list").html("");
            if (!val) return;
            let keywords = val.split(" ").filter((x)=>x.length>=2);
            let searchRes = search(keywords);
            searchRes.forEach((dat) => {
                $("#search-res-list").append(`<mdui-list-item href="${dat.url}" rounded headline-line="1" description-line="3">
          ${highlightSearch(dat.title, keywords)}
          <span slot="description">${highlightSearch(dat.content, keywords)}</span>
        </mdui-list-item>`);
            })
        })
    </script>
        
          <script>
            mdui.setColorScheme('#3f51b5');
            const navigationDrawer = document.querySelector("#drawer");
            const mainlayout = document.querySelector("#main");
            const breakpointCondition = mdui.breakpoint();
            if (breakpointCondition.up('sm')) {
              if (localStorage.getItem('navigationDrawer') == null) {
                if("true"=="true")localStorage.setItem('navigationDrawer', "true");
              }
              if("true"=="true")navigationDrawer.setAttribute("open", (localStorage.getItem('navigationDrawer') == "true" ? true : false))
            }
            const menuBtn = document.querySelector("#menu-btn");
            menuBtn.addEventListener("click", () => {
              navigationDrawer.open = !navigationDrawer.open;
              if("true"=="true")localStorage.setItem('navigationDrawer', navigationDrawer.open.toString());
            });
            const searchBtn = document.querySelector("#search-dlg-btn");
            searchBtn.addEventListener("click", () => {
              document.querySelector("#search-dlg").open = true;
            });
          </script>
          
<script src="/js/prism.js"></script>

  </body>

</html>