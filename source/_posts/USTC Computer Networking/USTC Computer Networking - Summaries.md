---
title: USTC Computer Networking - Summaries
date: 2024-12-10 16:35:59
tags:
categories: 
- USTC Computer Networking
---

采用每节课后总结要点的方式呈现知识体系。

---

![chap1.png](https://s2.loli.net/2024/12/26/vQfFLCuKasIS5XE.png)

---

## 1.1 什么是 Internet？

- Internet 从构成的角度来看，包括 **节点 (Node)** 、 **边 (Edge)** 、 **协议 (Protocol)** 。
  - 节点包括 **主机节点 (PC, Server)** 和 **数据交换节点 (Router, Switch)** 。
  - 边包括 **接入网链路 (Access Networking Link)** （和主机节点相关）和 **骨干链路 (Backbone Link)** （和数据交换节点相关）。
  - 协议存在于不同的层级之中 **（物理层、数据链路层、网络层、传输层、应用层）** ，规定了 **报文格式 (Message Format) （语法、语义）** 、 **次序 (Sequence)** 、 **动作 (Action)** 。
- 小网络 - 大网络 - 互联网
- 互联网：由一堆网络通过网络互联设备连在一起（网络的网络）
- 从分布式应用角度：由 **分布式应用 (Distributed Applications)** 以及 **为分布式应用提供通信服务 (API) 的基础设施** 组成。
  - 分布式应用：网络存在的理由
  - 基础设施： **面向连接 (TCP)** 、 **无连接 (UDP)**

---

## 1.2 网络边缘

- 网络结构包括 **边缘 (Edge)** 、 **核心 (Core)** 、 **接入网 (Access Network)** 。
  - 边缘是 **主机 (Host) / 端系统 (End System)** 及其运行的 **应用程序 (Client / Server)** 。
  - 核心是 **交换机 (Switch)** 、 **路由器 (Router)** 组成的 **网络** (交换节点和交换节点及其链路)。
  - 接入网是有线或无线的通信链路。
- 网络边缘有两种交换形式： **客户 / 服务器模式 (Client-Server)** 和 **对等模式 (Peer-To-Peer / P2P)**
  - CS模式容易拥堵，P2P模式实现带宽的扩大。
- 基础设施为网络应用提供的服务有两种方式： **TCP (Transmission Control Protocol)** 和 **UDP (User Datagram Protocol)** 。
  - 采用网络设施的面向连接服务 (TCP) 要求传输准确： **可靠地、按顺序地传送数据** 、 **流量控制** 、 **拥塞控制**
  - 采用基础设施的无连接服务 (UDP) 要求传输的时效性 ( **DNS** , 流媒体)： **无连接** 、 **不可靠数据传输** 、 **无流量控制** 、 **无拥塞控制**

---

## 1.3 网络核心

- 网络核心是路由器的网状网络，包括 **电路交换 (Circuit Switching)** 和 **分组交换 (Packet Switching)** 。
- **电路交换** 是端到端的资源分配，选取每条链路中的一条传输数据。
  - eg. `1.536Mbps` 的带宽分为 `24` 条线路，每条线路享有 `64Kbps` ( **片 Piece** )。
  - 特点： **线路独享 (Dedicated Line)** 、保证 **传输性能** 、 不使用时造成 **资源浪费** 、 需要建立 **呼叫链接** (延迟)
  - 经常被电话网络采用。
  - 分成片的方法有 **频分 (Frequency-Division Multiplexing)** 、 **时分 (Time-Division Multiplexing)** 、 **波分 (Wave-Division Multiplexing)** 和 **码分 (Code-Division Multiplexing)** 。对接入网链路而言加上 "Access"。
  > 例题：在一个电路交换网络上，从主机A到主机B发送一个 `640,000 bits` 的文件需要多长时间？ 所有的链路速率为 `1.536 Mbps` 、每条链路使用时隙数为 `24` 的TDM、建立端-端的电路需 `500 ms`
  - 缺点：连接建立时间长、对计算机通信的偶发性而言浪费片段多、可靠性不高(?)
- **分组交换** 是以分组为单位的 **存储-转发 (Store and Forward) (一动一跳 (Hop))** 方式。
  - 特点：使用 **全部带宽** 传输 (不再使用片)、数据被 **分组** 、 **线路共享 (Line Sharing )** 、节点 **全部接收数据** 才转发、延迟大、可能需要排队 (存在缓冲区)
  - 在一个速率为 `R bps` 的链路，一个长度为 `L bits` 的分组的存储转发延时： `L/R s` 。
  - 到达速率 > 链路的输出速率，分组将会排队，超出缓存就会被抛弃。
  - **路由 (Routing)** 决定分组传输路径 (路由算法：计算路由表)， **转发 (Forwarding)** 将分组由输入链路转移到输出链路。
  - **统计多路复用 (Statistical Multiplexing)** 没有固定分组模式。
  - 按照有无网络层连接分为 **数据报网络 (Datagram)** 和 **虚电路网络 (Virtual Circuit)**。
    - 数据报网络中每个分组都存有 **目标地址** ，路由器不维护通讯状态，路由表会改变 (路径可能不同)，不需要建立连接。虚电路网络中每个分组带有标签 **虚电路标识 VC ID** ，路由器维持每个呼叫状态 (通讯关系)。
    - 虚电路网络是 **有连接** ，TCP是 **面向连接** ，区别在于虚电路的路由需要维持通讯关系，而TCP只要建立源主机和目标主机的联系。(一个在网络层，一个在传输层)
- 比较两种分组：活动概率 `p`、活动带宽、链路带宽 (PPT P8)
  - 分组交换允许更多用户同时使用，即便超出带宽也有缓存。

---

## 1.4 接入网和物理媒体

- 端系统连接边缘路由器的方法：住宅接入网络、单位接入网络、无线接入网络
  - 住宅接入要使用 **调制解调器 (Modem - Modulator-Demodulator)** ，通过电话线将数据 **调制 (Modulator)** 在音频信号上，再在局端 **解调 (Demodulator)** 。
  - 调频 (FM)、调幅 (AM)、调相位 (PM)、综合调制
  - **拨号调制解调器 (Dial-up Modem)** 速率不大于 `56 Kbps` ，不能同时上网和打电话。
    - **DSL (Digital Subscriber Line)** 上的数据被传到互联网，语音被传到电话网。上下行不对称。电话线连接到 **DSLAM** ，再连接到 **ISP** 。是 **独享** 的。
    - **电缆网络 (Cable Network)** 将有线电视信号电缆双向改造。 **FDM** ：在不同的频段传输数字电视和上网数据 (上下行) (还有用于控制：信令)。是 **共享** 的。用户通过 **Cable Modem** 接入互联网
      - **HFC (Hybrid Fiber-Coaxial)** ： **光纤 (Optical Fiber)** 和 **同轴电缆 (Coaxial Cable)** 的混合。
      - 带宽上下行不对称。
      - 将家庭用户接入 ISP 路由器。
    - **家庭网络** 中有 **AP** 等设备，有线或者无线接入。综合设备具有路由、局部交换、无线接入 (AP) 、防火墙的功能。
  - **企业接入网络 (Ethernet)** 通过交换机的级联。
  - 无线接入网络
    - **LANs** ：`802.11b/g` (WiFi)，在建筑物内 `100 ft`
    - **关于无线接入 (WANs)** ：电信运营商用基站提供、3G, 4G, LTE, 5G
- **物理媒体 (Media)** 在发送-接收对中传输 `bit`。 **物理链路** 是连接每个节点对之间的物理媒体。
  - **导引型媒体** ：固体介质。同轴电缆、光纤、双绞线
    - **双绞线 (TP)** ：两根绝缘铜导线。CAT5、CAT6
    - **同轴电缆** ：两根同轴的铜导线
    - **光线和光缆** ：玻璃纤维二氧化硅中传播光脉冲，每个脉冲就是一个 `bit` 。码率极高、误码率极低：不受到电磁噪声的干扰、安全：不易被篡改和窃听。分为单模光纤和多模光纤。
  - **非导引型媒体** ：开放空间传输电磁波和光信号。
    - **无线链路** ：开放空间传输电磁波信号。有反射、吸收、干扰的效应。
      - 类型：地面微波、LAN、WAN、卫星

---

## 1.5 Internet 结构和 ISP

- 互联网也可以理解为 **网络的网络** 。
  - 端系统通过 **接入 ISPs (Internet Service Providers)** 连接到互联网。
  - ISP 存在于住宅、企业、学校。
  - 接入 ISPs 之间是 **互联** 的。
  - 这样的结构是由 **经济的和政治的政策** 来推动的。服务提供商有利可图，充满了 **竞争和合作** 。
- 数百万计 **Access ISPs (这里指的是 Local ISPs)** 可以接入 **Regional Net** 来接入上一层的 ISP **(Tier-3 ISP)** ，也可以直接接入上一层的 ISP ，也可以通过 **IXP (Internet Exchange Point)** 接入上一层的 ISP。
- **Regional Net** 也可以通过 **IXP** 接入 **Tier-3 ISP** 。
- 高层 ISP 面向客户网络的接入点叫做 **POP (Point of Presence)** ， **涉及费用结算** ，例如低层 ISP 接入多个高层 ISP —— **(多宿 Multihoming)** 。
- **Tier-3 ISPs** 之间可以直接相连 **(对等接入，不涉及费用结算)** ，也可以通过 IXP 相连 **(对等接入，不涉及费用结算)** 。
- 类似的有 **Tier-2 ISPs (区域性的)** 和 **Tier-1 ISPs (Global ISP)** 。
- **内容提供商网络 (Internet Content Providers)** 例如谷歌、百度，会在世界各地部署自己的 **Data Centres** 。有如下特征：
  - DC 一般部署在 ISP 附近，需要低温 (气候) 、远离自然灾害和战争。
  - 当端系统需要获取服务 (例如谷歌的地图) ，此时端系统通过访问最近的 ISP ，直接连接到 ISP 最近的 DC 。若此 DC 没有相应的服务， DC 之间可以通过 **专线** 直接向另一个 DC 索取信息。
  - DC 之间的 **专线** 可以是 ICP **自己铺设的** (经常是非法的) ，也可以是 **租用的** ，实现了 **成本的控制** 和 **服务质量的提高** 。
  - 中国的 ICPs 通过向政府呼吁，使得李克强总理发起电信运营商通信改革—— **提速降费** (流量不清零、流量转赠...) 。
  > 这是中国特有的降低成本的形式(?)，得益于三大运营商的国有运营和政府对经济的宏观调控，通过适当对运营商利润的削减达到刺激互联网经济发展的目的，但同时保证国有企业能够盈利，又能服务于民。
  > 我这一代人对此深有感触，感觉一夜之间流量便宜了，还能在下个月继续使用。永远悼念这一位为民的好总理...

---

## 1.6 分组延时、丢失和吞吐量

- 分组延迟的四种分类：

  $$
  d_{nodal} = d_{proc} + d_{queue} + d_{trans} + d_{prop}
  $$

  - **处理延时 (Processing Delay)** ：微秒数量级或者更小。检查 bit 级别差错和检查分组首部和决定将分组导向何处。
  - **排队延时 (Queuing Delay)** ：取决于拥塞程度。
  - **传输延时 (Transmission Delay)** ：存储转发的延时。

    $$
    d_{trans} = L (分组长度 / bits) / R (链路带宽 / bps)
    $$

  - **传播延时 (Propagation Delay)** ：
    $$
    d_{prop} = d (物理链路长度) / s (电磁波信号在媒体上的传播速度 约等于 2*10^8 m/s)
    $$

  - 类比：车队。局域网：还没传输完就已到达下一个节点；广域网：传输完了还要好久才到下一个节点。
  - **流量强度 (Traffic Intensity)** ：

    $$
    I = L (分组长度) a (分组到达队列的平均速率) / R (链路带宽)
    $$

    - \(I = 0\)：排队延时很小
    - \(I -> 1\)：延时变得很大
    - \(I > 1\)：排队延时趋近于无限大
    - 设计系统的流量强度**不能大于1**。
- **Internet 的延时和路由** ：使用 **Traceroute 诊断程序** 计算 **RTT (Round Trip Time)**
  - **TTL (Time to Live)** ：在 IP 数据包的头部中。每一 **跳 (Hop 段)** 减一，等于0时 **被丢弃** ，并发送一个 **ICMP** 消息 (通常是“超时”消息) 回源主机。
  - **ICMP (Internet Control Message Protocol)** ：网络协议，主要用于发送控制消息和错误消息
  - 最终访问目标主机一个 **比较大的端口号** ，目标主机必定 **没有应用在监听或者直接没有开放该端口** ，此时目标主机就会给源主机回一个 **ICMP 端口不可达** 的差错信息，源主机就知道了到目标主机的条数以及往返时间。

  ```bash
  tracert hostname
  ```

- **分组丢失 (Packet Loss)**
  - 链路的队列 **缓冲区容量有限** 。
  - 当分组到达一个满的队列时，该分组将会丢失。
  - 丢失的分组可能会 **被前一个节点 (链路是可靠的)** 或 **源端系统 (物理层是可靠的) 重传** ，或 **根本不重传 (UDP)** 。
- **吞吐量 (Throughput)** ：传输的实际速率
  - **瞬间吞吐量 (Instantaneous Throughput)**
  - **平均吞吐量 (Average Throughput)**
    - 每个连接会公平地共享带宽。

    $$
    AT = min(R_i / n_i)
    $$

  - **瓶颈链路** 经常是 \(R_c\) (连接源主机) 和 \(R_s\) (连接目标主机)。

---

## 1.7 协议层次及服务模型

- 网络是极其复杂的系统，以 **层次化 (Hierarchy)** 的方式实现。
  - 不同的层次实现了一个或一组 **功能** ，功能为上一层提供更好的 **服务** 。(功能是服务的 **超集** )
  - **本层协议 (Protocol)** 实体相互交互执行本层 **协议动作** 。
  - 本层的服务 = 本层协议实体之间交互带来的新功能 **+** 所有下层通过接口向本层提供的服务。
- 服务和服务访问点：
  - **服务 (Service)** 低层向上层提供通信的能力。
    - **服务用户 (Service User)** / **服务提供者 (Service Provider)**
  - **原语 (Primitive)** 是上层使用下层的 **形式** 。高层使用下层服务和下层为上层提供服务都是通过访问原语交互的。
  - **服务访问点 SAP (Services Access Point)** 是上层使用下层服务通过层间的 **接口** 。例如 **套接字 Socket API** 。
- 服务分为 **面向连接的服务 (Connection-Oriented Service)** 和 **无连接的服务 (Connectionless Service)** 。
  - 面向连接的服务 **可靠、保序 (不尽然)** ，需要 **预留资源** 。
  - 无连接的服务 **不可靠 (不尽然)、可能重复、可能失序** ，不需要 **缓冲区的置位** 。
- 服务是垂直的，协议是水平的。低层向高层提供通信的能力通过原语来实现。
  - **协议 (Protocol)** 是 **对等层实体 (Peer Entity)** 之间在相互通信的过程中需要遵守的规则的集合。
    - 协议的 **实现** ：本层协议的实现要靠下层提供的服务来实现。
    - 协议的 **目的** ：本层实体通过协议为上层提供更高级的服务。
- **数据单元 (DU)** 存在于每一层中。
  ![du_00.png](https://s2.loli.net/2024/12/21/uGwbLg4alDW9Ed1.png)
  ![du_01.png](https://s2.loli.net/2024/12/21/UCwmsAJBM7NKIto.png)
- 分层处理的特性：
  - **概念化** ：结构清晰便于描述。
  - **结构化** ：模块化更易于维护和升级，改变其中一层不改变其他层级。
  - **缺点** ：效率较低。
- **Internet 协议栈**
  - **物理层 (Physical Layer)** ：传输 **bit**。
  - **数据链路层 (Data Link Layer)** ：实现 **点到点 (P2P)** 的通信，相邻两点以 **帧 (Frame)** 为数据单元传输，有帧头、帧尾，可靠或不可靠。**和物理层封装在网卡当中**。 **PPP, 802.11(wifi), Ethernet**
  - **网络层 (Network Layer)** ：实现 **端到端 (E2E)** 的通信，以 **分组 (Packet) (无连接方式：数据报 Datagram)** 为数据单元传输，不可靠。 **IP, 路由协议**
  - **传输层 (Transport Layer)** ：实现 **进程到进程** 的通信，以 **报文段 (Segment) (TCP段、UDP Datagram)** 为数据单元传输，将不可靠变为可靠。 **TCP, UDP**
  - **应用层 (Application Layer)** 实现网络应用服务，以 **报文 (Message)** 为数据单元传输。 **FTP, SMTP, HTTP, DNS**
- **ISO/OSI 参考模型** (在 TCP/IP 中于应用层实现)
  - **表示层 (Presentation Layer)** ：关心语义不关心表达。解释传输的数据 (加密，压缩，机器相关的表示转换)。
  - **会话层 (Session Layer)** ：数据交换的同步、检查点、恢复。
- **封装 (Encapsulation) 和解封装 (Decapsulation)**
  ![encapsulation_00.png](https://s2.loli.net/2024/12/21/TyzRHxmANF24Jge.png)

---

## 1.8 历史

- 美国军方资助的 ARPANET -> TCP/IP (而不是ISO/OSI) -> 美国学术界 NFSNET -> Unix 免费提供 TCP/IP 的推广 -> 微软凭借垄断地位提供 IE 取代 Netscape -> 移动互联 -> 物联网

---

## 1.9 总结

- 协议：对等层实体通信过程中遵守的规则的集合 (语义、语法、时序)
- 网络边缘 (端系统+接入网) 、核心 (网络交换设备+通信链路) 、接入网络
  - 网络核心：线路交换、分组交换
    - 分组交换分为虚电路和数据报 (有无连接)：丢失、四种延迟 (处理、传输、传播、排队) 、吞吐量
- 松散的层次结构 (ICP 的加入)、网络的网络
  - 接入：无线、有线、机构、家庭
  - 服务、协议、服务访问点 (SAP) 、协议数据单元 (PDU) 、 服务数据单元 (SDU) 、原语
- 层次结构、服务模型：每个层次实现一个或者一组功能，本层协议的实现通过层间接口调用下层所提供的服务，实现本层协议的目的是通过接口向上层提供更好的服务。
- 互联网的历史

- **第一章习题 P46**

---

### 2.0 应用层概述
